import{r as t,M as S,j as P,h as W,u as z,P as A,D as H,x as K,L as U}from"./index-B-HRXyag.js";class b extends t.Component{getSnapshotBeforeUpdate(f){const e=this.props.childRef.current;if(e&&f.isPresent&&!this.props.isPresent){const l=e.offsetParent,m=W(l)&&l.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=m-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function B({children:o,isPresent:f,anchorX:e,root:l}){const m=t.useId(),n=t.useRef(null),p=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:g}=t.useContext(S);return t.useInsertionEffect(()=>{const{width:y,height:s,top:C,left:r,right:u}=p.current;if(f||!n.current||!y||!s)return;const d=e==="left"?`left: ${r}`:`right: ${u}`;n.current.dataset.motionPopId=m;const c=document.createElement("style");g&&(c.nonce=g);const h=l??document.head;return h.appendChild(c),c.sheet&&c.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${y}px !important;
            height: ${s}px !important;
            ${d}px !important;
            top: ${C}px !important;
          }
        `),()=>{h.contains(c)&&h.removeChild(c)}},[f]),P.jsx(b,{isPresent:f,childRef:n,sizeRef:p,children:t.cloneElement(o,{ref:n})})}const F=({children:o,initial:f,isPresent:e,onExitComplete:l,custom:m,presenceAffectsLayout:n,mode:p,anchorX:g,root:y})=>{const s=z(G),C=t.useId();let r=!0,u=t.useMemo(()=>(r=!1,{id:C,initial:f,isPresent:e,custom:m,onExitComplete:d=>{s.set(d,!0);for(const c of s.values())if(!c)return;l&&l()},register:d=>(s.set(d,!1),()=>s.delete(d))}),[e,s,l]);return n&&r&&(u={...u}),t.useMemo(()=>{s.forEach((d,c)=>s.set(c,!1))},[e]),t.useEffect(()=>{!e&&!s.size&&l&&l()},[e]),p==="popLayout"&&(o=P.jsx(B,{isPresent:e,anchorX:g,root:y,children:o})),P.jsx(A.Provider,{value:u,children:o})};function G(){return new Map}const R=o=>o.key||"";function L(o){const f=[];return t.Children.forEach(o,e=>{t.isValidElement(e)&&f.push(e)}),f}const V=({children:o,custom:f,initial:e=!0,onExitComplete:l,presenceAffectsLayout:m=!0,mode:n="sync",propagate:p=!1,anchorX:g="left",root:y})=>{const[s,C]=H(p),r=t.useMemo(()=>L(o),[o]),u=p&&!s?[]:r.map(R),d=t.useRef(!0),c=t.useRef(r),h=z(()=>new Map),[I,k]=t.useState(r),[x,$]=t.useState(r);K(()=>{d.current=!1,c.current=r;for(let a=0;a<x.length;a++){const i=R(x[a]);u.includes(i)?h.delete(i):h.get(i)!==!0&&h.set(i,!1)}},[x,u.length,u.join("-")]);const M=[];if(r!==I){let a=[...r];for(let i=0;i<x.length;i++){const E=x[i],j=R(E);u.includes(j)||(a.splice(i,0,E),M.push(E))}return n==="wait"&&M.length&&(a=M),$(L(a)),k(r),null}const{forceRender:w}=t.useContext(U);return P.jsx(P.Fragment,{children:x.map(a=>{const i=R(a),E=p&&!s?!1:r===x||u.includes(i),j=()=>{if(h.has(i))h.set(i,!0);else return;let v=!0;h.forEach(D=>{D||(v=!1)}),v&&(w==null||w(),$(c.current),p&&(C==null||C()),l&&l())};return P.jsx(F,{isPresent:E,initial:!d.current||e?void 0:!1,custom:f,presenceAffectsLayout:m,mode:n,root:y,onExitComplete:E?void 0:j,anchorX:g,children:a},i)})})};export{V as A};
