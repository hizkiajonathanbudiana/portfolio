import{_ as je}from"./extends-C1sQzDBQ.js";import{r as y}from"./index-B-HRXyag.js";import{k as Vt,t as nn,v as Tt,q as an,c as re,w as xr,Q as St,O as jt,V as Be,x as ir,y as ct,z as ut,A as on,E as sn,F as Ur,H as Ae,G as Ye,J as dt,L as Ge,K as It,N as ln,u as ge,d as Ct,B as Or,m as cn,f as or,W as Ve,X as Pr,P as mr,Y as ft,Z as Xt,_ as un,$ as hn,a0 as ur,b as pt,l as dn,a1 as pn,a2 as mn,a3 as fn,a4 as vn,a5 as hr,a6 as Yt,a7 as gn,a8 as wn,a9 as Tr,aa as yn,ab as En,a as $t,ac as _n,ad as Mn,ae as bn,e as Fr,af as Sn,ag as xn,g as Ir,i as Tn,C as fr,ah as sr,ai as Rr,M as In}from"./events-e3cb66e2.esm-DFm8s4y8.js";import{v as Lr}from"./BufferGeometryUtils-7-XupBXG.js";import{s as Nr,v as kr}from"./constants-DldQVOpp.js";var Pe=Uint8Array,Ke=Uint16Array,dr=Uint32Array,Br=new Pe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zr=new Pe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Rn=new Pe([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Hr=function(a,r){for(var i=new Ke(31),t=0;t<31;++t)i[t]=r+=1<<a[t-1];for(var l=new dr(i[30]),t=1;t<30;++t)for(var c=i[t];c<i[t+1];++c)l[c]=c-i[t]<<5|t;return[i,l]},Zr=Hr(Br,2),Gr=Zr[0],Cn=Zr[1];Gr[28]=258,Cn[258]=28;var An=Hr(zr,0),Dn=An[0],pr=new Ke(32768);for(var pe=0;pe<32768;++pe){var $e=(pe&43690)>>>1|(pe&21845)<<1;$e=($e&52428)>>>2|($e&13107)<<2,$e=($e&61680)>>>4|($e&3855)<<4,pr[pe]=(($e&65280)>>>8|($e&255)<<8)>>>1}var xt=function(a,r,i){for(var t=a.length,l=0,c=new Ke(r);l<t;++l)++c[a[l]-1];var d=new Ke(r);for(l=0;l<r;++l)d[l]=d[l-1]+c[l-1]<<1;var m;if(i){m=new Ke(1<<r);var p=15-r;for(l=0;l<t;++l)if(a[l])for(var u=l<<4|a[l],T=r-a[l],R=d[a[l]-1]++<<T,E=R|(1<<T)-1;R<=E;++R)m[pr[R]>>>p]=u}else for(m=new Ke(t),l=0;l<t;++l)a[l]&&(m[l]=pr[d[a[l]-1]++]>>>15-a[l]);return m},At=new Pe(288);for(var pe=0;pe<144;++pe)At[pe]=8;for(var pe=144;pe<256;++pe)At[pe]=9;for(var pe=256;pe<280;++pe)At[pe]=7;for(var pe=280;pe<288;++pe)At[pe]=8;var Wr=new Pe(32);for(var pe=0;pe<32;++pe)Wr[pe]=5;var Un=xt(At,9,1),On=xt(Wr,5,1),lr=function(a){for(var r=a[0],i=1;i<a.length;++i)a[i]>r&&(r=a[i]);return r},ze=function(a,r,i){var t=r/8|0;return(a[t]|a[t+1]<<8)>>(r&7)&i},cr=function(a,r){var i=r/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(r&7)},Pn=function(a){return(a/8|0)+(a&7&&1)},Fn=function(a,r,i){(i==null||i>a.length)&&(i=a.length);var t=new(a instanceof Ke?Ke:a instanceof dr?dr:Pe)(i-r);return t.set(a.subarray(r,i)),t},Ln=function(a,r,i){var t=a.length;if(!t||i&&!i.l&&t<5)return r||new Pe(0);var l=!r||i,c=!i||i.i;i||(i={}),r||(r=new Pe(t*3));var d=function(ie){var Fe=r.length;if(ie>Fe){var Le=new Pe(Math.max(Fe*2,ie));Le.set(r),r=Le}},m=i.f||0,p=i.p||0,u=i.b||0,T=i.l,R=i.d,E=i.m,G=i.n,B=t*8;do{if(!T){i.f=m=ze(a,p,1);var S=ze(a,p+1,3);if(p+=3,S)if(S==1)T=Un,R=On,E=9,G=5;else if(S==2){var W=ze(a,p,31)+257,z=ze(a,p+10,15)+4,_=W+ze(a,p+5,31)+1;p+=14;for(var g=new Pe(_),N=new Pe(19),w=0;w<z;++w)N[Rn[w]]=ze(a,p+w*3,7);p+=z*3;for(var M=lr(N),P=(1<<M)-1,V=xt(N,M,1),w=0;w<_;){var q=V[ze(a,p,P)];p+=q&15;var U=q>>>4;if(U<16)g[w++]=U;else{var $=0,H=0;for(U==16?(H=3+ze(a,p,3),p+=2,$=g[w-1]):U==17?(H=3+ze(a,p,7),p+=3):U==18&&(H=11+ze(a,p,127),p+=7);H--;)g[w++]=$}}var ee=g.subarray(0,W),K=g.subarray(W);E=lr(ee),G=lr(K),T=xt(ee,E,1),R=xt(K,G,1)}else throw"invalid block type";else{var U=Pn(p)+4,L=a[U-4]|a[U-3]<<8,I=U+L;if(I>t){if(c)throw"unexpected EOF";break}l&&d(u+L),r.set(a.subarray(U,I),u),i.b=u+=L,i.p=p=I*8;continue}if(p>B){if(c)throw"unexpected EOF";break}}l&&d(u+131072);for(var _e=(1<<E)-1,we=(1<<G)-1,Me=p;;Me=p){var $=T[cr(a,p)&_e],ne=$>>>4;if(p+=$&15,p>B){if(c)throw"unexpected EOF";break}if(!$)throw"invalid length/literal";if(ne<256)r[u++]=ne;else if(ne==256){Me=p,T=null;break}else{var ye=ne-254;if(ne>264){var w=ne-257,se=Br[w];ye=ze(a,p,(1<<se)-1)+Gr[w],p+=se}var ve=R[cr(a,p)&we],Re=ve>>>4;if(!ve)throw"invalid distance";p+=ve&15;var K=Dn[Re];if(Re>3){var se=zr[Re];K+=cr(a,p)&(1<<se)-1,p+=se}if(p>B){if(c)throw"unexpected EOF";break}l&&d(u+131072);for(var qe=u+ye;u<qe;u+=4)r[u]=r[u-K],r[u+1]=r[u+1-K],r[u+2]=r[u+2-K],r[u+3]=r[u+3-K];u=qe}}i.l=T,i.p=Me,i.b=u,T&&(m=1,i.m=E,i.d=R,i.n=G)}while(!m);return u==r.length?r:Fn(r,0,u)},Nn=new Pe(0),kn=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function Zt(a,r){return Ln((kn(a),a.subarray(2,-4)),r)}var Bn=typeof TextDecoder<"u"&&new TextDecoder,zn=0;try{Bn.decode(Nn,{stream:!0}),zn=1}catch{}const Hn=a=>a&&a.isCubeTexture;class Zn extends Vt{constructor(r,i){var t,l;const c=Hn(r),m=((l=c?(t=r.image[0])==null?void 0:t.width:r.image.width)!=null?l:1024)/4,p=Math.floor(Math.log2(m)),u=Math.pow(2,p),T=3*Math.max(u,112),R=4*u,E=[c?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/T}`,`#define CUBEUV_TEXEL_HEIGHT ${1/R}`,`#define CUBEUV_MAX_MIP ${p}.0`],G=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,B=E.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Lr>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,S={map:{value:r},height:{value:(i==null?void 0:i.height)||15},radius:{value:(i==null?void 0:i.radius)||100}},U=new nn(1,16),L=new Tt({uniforms:S,fragmentShader:B,vertexShader:G,side:an});super(U,L)}set radius(r){this.material.uniforms.radius.value=r}get radius(){return this.material.uniforms.radius.value}set height(r){this.material.uniforms.height.value=r}get height(){return this.material.uniforms.height.value}}var Gn=Object.defineProperty,Wn=(a,r,i)=>r in a?Gn(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,jn=(a,r,i)=>(Wn(a,r+"",i),i);class Yn{constructor(){jn(this,"_listeners")}addEventListener(r,i){this._listeners===void 0&&(this._listeners={});const t=this._listeners;t[r]===void 0&&(t[r]=[]),t[r].indexOf(i)===-1&&t[r].push(i)}hasEventListener(r,i){if(this._listeners===void 0)return!1;const t=this._listeners;return t[r]!==void 0&&t[r].indexOf(i)!==-1}removeEventListener(r,i){if(this._listeners===void 0)return;const l=this._listeners[r];if(l!==void 0){const c=l.indexOf(i);c!==-1&&l.splice(c,1)}}dispatchEvent(r){if(this._listeners===void 0)return;const t=this._listeners[r.type];if(t!==void 0){r.target=this;const l=t.slice(0);for(let c=0,d=l.length;c<d;c++)l[c].call(this,r);r.target=null}}}var Xn=Object.defineProperty,$n=(a,r,i)=>r in a?Xn(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,X=(a,r,i)=>($n(a,typeof r!="symbol"?r+"":r,i),i);const Gt=new on,Cr=new sn,Vn=Math.cos(70*(Math.PI/180)),Ar=(a,r)=>(a%r+r)%r;let Kn=class extends Yn{constructor(r,i){super(),X(this,"object"),X(this,"domElement"),X(this,"enabled",!0),X(this,"target",new re),X(this,"minDistance",0),X(this,"maxDistance",1/0),X(this,"minZoom",0),X(this,"maxZoom",1/0),X(this,"minPolarAngle",0),X(this,"maxPolarAngle",Math.PI),X(this,"minAzimuthAngle",-1/0),X(this,"maxAzimuthAngle",1/0),X(this,"enableDamping",!1),X(this,"dampingFactor",.05),X(this,"enableZoom",!0),X(this,"zoomSpeed",1),X(this,"enableRotate",!0),X(this,"rotateSpeed",1),X(this,"enablePan",!0),X(this,"panSpeed",1),X(this,"screenSpacePanning",!0),X(this,"keyPanSpeed",7),X(this,"zoomToCursor",!1),X(this,"autoRotate",!1),X(this,"autoRotateSpeed",2),X(this,"reverseOrbit",!1),X(this,"reverseHorizontalOrbit",!1),X(this,"reverseVerticalOrbit",!1),X(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),X(this,"mouseButtons",{LEFT:ct.ROTATE,MIDDLE:ct.DOLLY,RIGHT:ct.PAN}),X(this,"touches",{ONE:ut.ROTATE,TWO:ut.DOLLY_PAN}),X(this,"target0"),X(this,"position0"),X(this,"zoom0"),X(this,"_domElementKeyEvents",null),X(this,"getPolarAngle"),X(this,"getAzimuthalAngle"),X(this,"setPolarAngle"),X(this,"setAzimuthalAngle"),X(this,"getDistance"),X(this,"getZoomScale"),X(this,"listenToKeyEvents"),X(this,"stopListenToKeyEvents"),X(this,"saveState"),X(this,"reset"),X(this,"update"),X(this,"connect"),X(this,"dispose"),X(this,"dollyIn"),X(this,"dollyOut"),X(this,"getScale"),X(this,"setScale"),this.object=r,this.domElement=i,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>T.phi,this.getAzimuthalAngle=()=>T.theta,this.setPolarAngle=s=>{let x=Ar(s,2*Math.PI),Z=T.phi;Z<0&&(Z+=2*Math.PI),x<0&&(x+=2*Math.PI);let ae=Math.abs(x-Z);2*Math.PI-ae<ae&&(x<Z?x+=2*Math.PI:Z+=2*Math.PI),R.phi=x-Z,t.update()},this.setAzimuthalAngle=s=>{let x=Ar(s,2*Math.PI),Z=T.theta;Z<0&&(Z+=2*Math.PI),x<0&&(x+=2*Math.PI);let ae=Math.abs(x-Z);2*Math.PI-ae<ae&&(x<Z?x+=2*Math.PI:Z+=2*Math.PI),R.theta=x-Z,t.update()},this.getDistance=()=>t.object.position.distanceTo(t.target),this.listenToKeyEvents=s=>{s.addEventListener("keydown",it),this._domElementKeyEvents=s},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",it),this._domElementKeyEvents=null},this.saveState=()=>{t.target0.copy(t.target),t.position0.copy(t.object.position),t.zoom0=t.object.zoom},this.reset=()=>{t.target.copy(t.target0),t.object.position.copy(t.position0),t.object.zoom=t.zoom0,t.object.updateProjectionMatrix(),t.dispatchEvent(l),t.update(),p=m.NONE},this.update=(()=>{const s=new re,x=new re(0,1,0),Z=new St().setFromUnitVectors(r.up,x),ae=Z.clone().invert(),A=new re,Te=new St,He=2*Math.PI;return function(){const zt=t.object.position;Z.setFromUnitVectors(r.up,x),ae.copy(Z).invert(),s.copy(zt).sub(t.target),s.applyQuaternion(Z),T.setFromVector3(s),t.autoRotate&&p===m.NONE&&H(q()),t.enableDamping?(T.theta+=R.theta*t.dampingFactor,T.phi+=R.phi*t.dampingFactor):(T.theta+=R.theta,T.phi+=R.phi);let Ne=t.minAzimuthAngle,ke=t.maxAzimuthAngle;isFinite(Ne)&&isFinite(ke)&&(Ne<-Math.PI?Ne+=He:Ne>Math.PI&&(Ne-=He),ke<-Math.PI?ke+=He:ke>Math.PI&&(ke-=He),Ne<=ke?T.theta=Math.max(Ne,Math.min(ke,T.theta)):T.theta=T.theta>(Ne+ke)/2?Math.max(Ne,T.theta):Math.min(ke,T.theta)),T.phi=Math.max(t.minPolarAngle,Math.min(t.maxPolarAngle,T.phi)),T.makeSafe(),t.enableDamping===!0?t.target.addScaledVector(G,t.dampingFactor):t.target.add(G),t.zoomToCursor&&M||t.object.isOrthographicCamera?T.radius=ve(T.radius):T.radius=ve(T.radius*E),s.setFromSpherical(T),s.applyQuaternion(ae),zt.copy(t.target).add(s),t.object.matrixAutoUpdate||t.object.updateMatrix(),t.object.lookAt(t.target),t.enableDamping===!0?(R.theta*=1-t.dampingFactor,R.phi*=1-t.dampingFactor,G.multiplyScalar(1-t.dampingFactor)):(R.set(0,0,0),G.set(0,0,0));let et=!1;if(t.zoomToCursor&&M){let tt=null;if(t.object instanceof ir&&t.object.isPerspectiveCamera){const rt=s.length();tt=ve(rt*E);const lt=rt-tt;t.object.position.addScaledVector(N,lt),t.object.updateMatrixWorld()}else if(t.object.isOrthographicCamera){const rt=new re(w.x,w.y,0);rt.unproject(t.object),t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/E)),t.object.updateProjectionMatrix(),et=!0;const lt=new re(w.x,w.y,0);lt.unproject(t.object),t.object.position.sub(lt).add(rt),t.object.updateMatrixWorld(),tt=s.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),t.zoomToCursor=!1;tt!==null&&(t.screenSpacePanning?t.target.set(0,0,-1).transformDirection(t.object.matrix).multiplyScalar(tt).add(t.object.position):(Gt.origin.copy(t.object.position),Gt.direction.set(0,0,-1).transformDirection(t.object.matrix),Math.abs(t.object.up.dot(Gt.direction))<Vn?r.lookAt(t.target):(Cr.setFromNormalAndCoplanarPoint(t.object.up,t.target),Gt.intersectPlane(Cr,t.target))))}else t.object instanceof jt&&t.object.isOrthographicCamera&&(et=E!==1,et&&(t.object.zoom=Math.max(t.minZoom,Math.min(t.maxZoom,t.object.zoom/E)),t.object.updateProjectionMatrix()));return E=1,M=!1,et||A.distanceToSquared(t.object.position)>u||8*(1-Te.dot(t.object.quaternion))>u?(t.dispatchEvent(l),A.copy(t.object.position),Te.copy(t.object.quaternion),et=!1,!0):!1}})(),this.connect=s=>{t.domElement=s,t.domElement.style.touchAction="none",t.domElement.addEventListener("contextmenu",Bt),t.domElement.addEventListener("pointerdown",Nt),t.domElement.addEventListener("pointercancel",Qe),t.domElement.addEventListener("wheel",kt)},this.dispose=()=>{var s,x,Z,ae,A,Te;t.domElement&&(t.domElement.style.touchAction="auto"),(s=t.domElement)==null||s.removeEventListener("contextmenu",Bt),(x=t.domElement)==null||x.removeEventListener("pointerdown",Nt),(Z=t.domElement)==null||Z.removeEventListener("pointercancel",Qe),(ae=t.domElement)==null||ae.removeEventListener("wheel",kt),(A=t.domElement)==null||A.ownerDocument.removeEventListener("pointermove",at),(Te=t.domElement)==null||Te.ownerDocument.removeEventListener("pointerup",Qe),t._domElementKeyEvents!==null&&t._domElementKeyEvents.removeEventListener("keydown",it)};const t=this,l={type:"change"},c={type:"start"},d={type:"end"},m={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let p=m.NONE;const u=1e-6,T=new xr,R=new xr;let E=1;const G=new re,B=new Be,S=new Be,U=new Be,L=new Be,I=new Be,W=new Be,z=new Be,_=new Be,g=new Be,N=new re,w=new Be;let M=!1;const P=[],V={};function q(){return 2*Math.PI/60/60*t.autoRotateSpeed}function $(){return Math.pow(.95,t.zoomSpeed)}function H(s){t.reverseOrbit||t.reverseHorizontalOrbit?R.theta+=s:R.theta-=s}function ee(s){t.reverseOrbit||t.reverseVerticalOrbit?R.phi+=s:R.phi-=s}const K=(()=>{const s=new re;return function(Z,ae){s.setFromMatrixColumn(ae,0),s.multiplyScalar(-Z),G.add(s)}})(),_e=(()=>{const s=new re;return function(Z,ae){t.screenSpacePanning===!0?s.setFromMatrixColumn(ae,1):(s.setFromMatrixColumn(ae,0),s.crossVectors(t.object.up,s)),s.multiplyScalar(Z),G.add(s)}})(),we=(()=>{const s=new re;return function(Z,ae){const A=t.domElement;if(A&&t.object instanceof ir&&t.object.isPerspectiveCamera){const Te=t.object.position;s.copy(Te).sub(t.target);let He=s.length();He*=Math.tan(t.object.fov/2*Math.PI/180),K(2*Z*He/A.clientHeight,t.object.matrix),_e(2*ae*He/A.clientHeight,t.object.matrix)}else A&&t.object instanceof jt&&t.object.isOrthographicCamera?(K(Z*(t.object.right-t.object.left)/t.object.zoom/A.clientWidth,t.object.matrix),_e(ae*(t.object.top-t.object.bottom)/t.object.zoom/A.clientHeight,t.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),t.enablePan=!1)}})();function Me(s){t.object instanceof ir&&t.object.isPerspectiveCamera||t.object instanceof jt&&t.object.isOrthographicCamera?E=s:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),t.enableZoom=!1)}function ne(s){Me(E/s)}function ye(s){Me(E*s)}function se(s){if(!t.zoomToCursor||!t.domElement)return;M=!0;const x=t.domElement.getBoundingClientRect(),Z=s.clientX-x.left,ae=s.clientY-x.top,A=x.width,Te=x.height;w.x=Z/A*2-1,w.y=-(ae/Te)*2+1,N.set(w.x,w.y,1).unproject(t.object).sub(t.object.position).normalize()}function ve(s){return Math.max(t.minDistance,Math.min(t.maxDistance,s))}function Re(s){B.set(s.clientX,s.clientY)}function qe(s){se(s),z.set(s.clientX,s.clientY)}function ie(s){L.set(s.clientX,s.clientY)}function Fe(s){S.set(s.clientX,s.clientY),U.subVectors(S,B).multiplyScalar(t.rotateSpeed);const x=t.domElement;x&&(H(2*Math.PI*U.x/x.clientHeight),ee(2*Math.PI*U.y/x.clientHeight)),B.copy(S),t.update()}function Le(s){_.set(s.clientX,s.clientY),g.subVectors(_,z),g.y>0?ne($()):g.y<0&&ye($()),z.copy(_),t.update()}function qt(s){I.set(s.clientX,s.clientY),W.subVectors(I,L).multiplyScalar(t.panSpeed),we(W.x,W.y),L.copy(I),t.update()}function Qt(s){se(s),s.deltaY<0?ye($()):s.deltaY>0&&ne($()),t.update()}function Dt(s){let x=!1;switch(s.code){case t.keys.UP:we(0,t.keyPanSpeed),x=!0;break;case t.keys.BOTTOM:we(0,-t.keyPanSpeed),x=!0;break;case t.keys.LEFT:we(t.keyPanSpeed,0),x=!0;break;case t.keys.RIGHT:we(-t.keyPanSpeed,0),x=!0;break}x&&(s.preventDefault(),t.update())}function Ut(){if(P.length==1)B.set(P[0].pageX,P[0].pageY);else{const s=.5*(P[0].pageX+P[1].pageX),x=.5*(P[0].pageY+P[1].pageY);B.set(s,x)}}function vt(){if(P.length==1)L.set(P[0].pageX,P[0].pageY);else{const s=.5*(P[0].pageX+P[1].pageX),x=.5*(P[0].pageY+P[1].pageY);L.set(s,x)}}function gt(){const s=P[0].pageX-P[1].pageX,x=P[0].pageY-P[1].pageY,Z=Math.sqrt(s*s+x*x);z.set(0,Z)}function Ot(){t.enableZoom&&gt(),t.enablePan&&vt()}function Jt(){t.enableZoom&&gt(),t.enableRotate&&Ut()}function Pt(s){if(P.length==1)S.set(s.pageX,s.pageY);else{const Z=st(s),ae=.5*(s.pageX+Z.x),A=.5*(s.pageY+Z.y);S.set(ae,A)}U.subVectors(S,B).multiplyScalar(t.rotateSpeed);const x=t.domElement;x&&(H(2*Math.PI*U.x/x.clientHeight),ee(2*Math.PI*U.y/x.clientHeight)),B.copy(S)}function Ft(s){if(P.length==1)I.set(s.pageX,s.pageY);else{const x=st(s),Z=.5*(s.pageX+x.x),ae=.5*(s.pageY+x.y);I.set(Z,ae)}W.subVectors(I,L).multiplyScalar(t.panSpeed),we(W.x,W.y),L.copy(I)}function Lt(s){const x=st(s),Z=s.pageX-x.x,ae=s.pageY-x.y,A=Math.sqrt(Z*Z+ae*ae);_.set(0,A),g.set(0,Math.pow(_.y/z.y,t.zoomSpeed)),ne(g.y),z.copy(_)}function er(s){t.enableZoom&&Lt(s),t.enablePan&&Ft(s)}function tr(s){t.enableZoom&&Lt(s),t.enableRotate&&Pt(s)}function Nt(s){var x,Z;t.enabled!==!1&&(P.length===0&&((x=t.domElement)==null||x.ownerDocument.addEventListener("pointermove",at),(Z=t.domElement)==null||Z.ownerDocument.addEventListener("pointerup",Qe)),ar(s),s.pointerType==="touch"?ot(s):wt(s))}function at(s){t.enabled!==!1&&(s.pointerType==="touch"?nr(s):rr(s))}function Qe(s){var x,Z,ae;Je(s),P.length===0&&((x=t.domElement)==null||x.releasePointerCapture(s.pointerId),(Z=t.domElement)==null||Z.ownerDocument.removeEventListener("pointermove",at),(ae=t.domElement)==null||ae.ownerDocument.removeEventListener("pointerup",Qe)),t.dispatchEvent(d),p=m.NONE}function wt(s){let x;switch(s.button){case 0:x=t.mouseButtons.LEFT;break;case 1:x=t.mouseButtons.MIDDLE;break;case 2:x=t.mouseButtons.RIGHT;break;default:x=-1}switch(x){case ct.DOLLY:if(t.enableZoom===!1)return;qe(s),p=m.DOLLY;break;case ct.ROTATE:if(s.ctrlKey||s.metaKey||s.shiftKey){if(t.enablePan===!1)return;ie(s),p=m.PAN}else{if(t.enableRotate===!1)return;Re(s),p=m.ROTATE}break;case ct.PAN:if(s.ctrlKey||s.metaKey||s.shiftKey){if(t.enableRotate===!1)return;Re(s),p=m.ROTATE}else{if(t.enablePan===!1)return;ie(s),p=m.PAN}break;default:p=m.NONE}p!==m.NONE&&t.dispatchEvent(c)}function rr(s){if(t.enabled!==!1)switch(p){case m.ROTATE:if(t.enableRotate===!1)return;Fe(s);break;case m.DOLLY:if(t.enableZoom===!1)return;Le(s);break;case m.PAN:if(t.enablePan===!1)return;qt(s);break}}function kt(s){t.enabled===!1||t.enableZoom===!1||p!==m.NONE&&p!==m.ROTATE||(s.preventDefault(),t.dispatchEvent(c),Qt(s),t.dispatchEvent(d))}function it(s){t.enabled===!1||t.enablePan===!1||Dt(s)}function ot(s){switch(Se(s),P.length){case 1:switch(t.touches.ONE){case ut.ROTATE:if(t.enableRotate===!1)return;Ut(),p=m.TOUCH_ROTATE;break;case ut.PAN:if(t.enablePan===!1)return;vt(),p=m.TOUCH_PAN;break;default:p=m.NONE}break;case 2:switch(t.touches.TWO){case ut.DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;Ot(),p=m.TOUCH_DOLLY_PAN;break;case ut.DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;Jt(),p=m.TOUCH_DOLLY_ROTATE;break;default:p=m.NONE}break;default:p=m.NONE}p!==m.NONE&&t.dispatchEvent(c)}function nr(s){switch(Se(s),p){case m.TOUCH_ROTATE:if(t.enableRotate===!1)return;Pt(s),t.update();break;case m.TOUCH_PAN:if(t.enablePan===!1)return;Ft(s),t.update();break;case m.TOUCH_DOLLY_PAN:if(t.enableZoom===!1&&t.enablePan===!1)return;er(s),t.update();break;case m.TOUCH_DOLLY_ROTATE:if(t.enableZoom===!1&&t.enableRotate===!1)return;tr(s),t.update();break;default:p=m.NONE}}function Bt(s){t.enabled!==!1&&s.preventDefault()}function ar(s){P.push(s)}function Je(s){delete V[s.pointerId];for(let x=0;x<P.length;x++)if(P[x].pointerId==s.pointerId){P.splice(x,1);return}}function Se(s){let x=V[s.pointerId];x===void 0&&(x=new Be,V[s.pointerId]=x),x.set(s.pageX,s.pageY)}function st(s){const x=s.pointerId===P[0].pointerId?P[1]:P[0];return V[x.pointerId]}this.dollyIn=(s=$())=>{ye(s),t.update()},this.dollyOut=(s=$())=>{ne(s),t.update()},this.getScale=()=>E,this.setScale=s=>{Me(s),t.update()},this.getZoomScale=()=>$(),i!==void 0&&this.connect(i),this.update()}};const qn={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},Qn={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `};class Jn extends Ur{constructor(r){super(r),this.type=Ae}parse(r){const d=function(w,M){switch(w){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(M||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(M||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(M||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(M||""))}},R=function(w,M,P){M=M||1024;let q=w.pos,$=-1,H=0,ee="",K=String.fromCharCode.apply(null,new Uint16Array(w.subarray(q,q+128)));for(;0>($=K.indexOf(`
`))&&H<M&&q<w.byteLength;)ee+=K,H+=K.length,q+=128,K+=String.fromCharCode.apply(null,new Uint16Array(w.subarray(q,q+128)));return-1<$?(w.pos+=H+$+1,ee+K.slice(0,$)):!1},E=function(w){const M=/^#\?(\S+)/,P=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,V=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,q=/^\s*FORMAT=(\S+)\s*$/,$=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,H={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let ee,K;for((w.pos>=w.byteLength||!(ee=R(w)))&&d(1,"no header found"),(K=ee.match(M))||d(3,"bad initial token"),H.valid|=1,H.programtype=K[1],H.string+=ee+`
`;ee=R(w),ee!==!1;){if(H.string+=ee+`
`,ee.charAt(0)==="#"){H.comments+=ee+`
`;continue}if((K=ee.match(P))&&(H.gamma=parseFloat(K[1])),(K=ee.match(V))&&(H.exposure=parseFloat(K[1])),(K=ee.match(q))&&(H.valid|=2,H.format=K[1]),(K=ee.match($))&&(H.valid|=4,H.height=parseInt(K[1],10),H.width=parseInt(K[2],10)),H.valid&2&&H.valid&4)break}return H.valid&2||d(3,"missing format specifier"),H.valid&4||d(3,"missing image size specifier"),H},G=function(w,M,P){const V=M;if(V<8||V>32767||w[0]!==2||w[1]!==2||w[2]&128)return new Uint8Array(w);V!==(w[2]<<8|w[3])&&d(3,"wrong scanline width");const q=new Uint8Array(4*M*P);q.length||d(4,"unable to allocate buffer space");let $=0,H=0;const ee=4*V,K=new Uint8Array(4),_e=new Uint8Array(ee);let we=P;for(;we>0&&H<w.byteLength;){H+4>w.byteLength&&d(1),K[0]=w[H++],K[1]=w[H++],K[2]=w[H++],K[3]=w[H++],(K[0]!=2||K[1]!=2||(K[2]<<8|K[3])!=V)&&d(3,"bad rgbe scanline format");let Me=0,ne;for(;Me<ee&&H<w.byteLength;){ne=w[H++];const se=ne>128;if(se&&(ne-=128),(ne===0||Me+ne>ee)&&d(3,"bad scanline data"),se){const ve=w[H++];for(let Re=0;Re<ne;Re++)_e[Me++]=ve}else _e.set(w.subarray(H,H+ne),Me),Me+=ne,H+=ne}const ye=V;for(let se=0;se<ye;se++){let ve=0;q[$]=_e[se+ve],ve+=V,q[$+1]=_e[se+ve],ve+=V,q[$+2]=_e[se+ve],ve+=V,q[$+3]=_e[se+ve],$+=4}we--}return q},B=function(w,M,P,V){const q=w[M+3],$=Math.pow(2,q-128)/255;P[V+0]=w[M+0]*$,P[V+1]=w[M+1]*$,P[V+2]=w[M+2]*$,P[V+3]=1},S=function(w,M,P,V){const q=w[M+3],$=Math.pow(2,q-128)/255;P[V+0]=dt.toHalfFloat(Math.min(w[M+0]*$,65504)),P[V+1]=dt.toHalfFloat(Math.min(w[M+1]*$,65504)),P[V+2]=dt.toHalfFloat(Math.min(w[M+2]*$,65504)),P[V+3]=dt.toHalfFloat(1)},U=new Uint8Array(r);U.pos=0;const L=E(U),I=L.width,W=L.height,z=G(U.subarray(U.pos),I,W);let _,g,N;switch(this.type){case Ye:N=z.length/4;const w=new Float32Array(N*4);for(let P=0;P<N;P++)B(z,P*4,w,P*4);_=w,g=Ye;break;case Ae:N=z.length/4;const M=new Uint16Array(N*4);for(let P=0;P<N;P++)S(z,P*4,M,P*4);_=M,g=Ae;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:I,height:W,data:_,header:L.string,gamma:L.gamma,exposure:L.exposure,type:g}}setDataType(r){return this.type=r,this}load(r,i,t,l){function c(d,m){switch(d.type){case Ye:case Ae:"colorSpace"in d?d.colorSpace="srgb-linear":d.encoding=3e3,d.minFilter=Ge,d.magFilter=Ge,d.generateMipmaps=!1,d.flipY=!0;break}i&&i(d,m)}return super.load(r,c,t,l)}}const Mt=Lr>=152;class ea extends Ur{constructor(r){super(r),this.type=Ae}parse(r){const M=Math.pow(2.7182818,2.2);function P(e,n){for(var o=0,h=0;h<65536;++h)(h==0||e[h>>3]&1<<(h&7))&&(n[o++]=h);for(var f=o-1;o<65536;)n[o++]=0;return f}function V(e){for(var n=0;n<16384;n++)e[n]={},e[n].len=0,e[n].lit=0,e[n].p=null}const q={l:0,c:0,lc:0};function $(e,n,o,h,f){for(;o<e;)n=n<<8|st(h,f),o+=8;o-=e,q.l=n>>o&(1<<e)-1,q.c=n,q.lc=o}const H=new Array(59);function ee(e){for(var n=0;n<=58;++n)H[n]=0;for(var n=0;n<65537;++n)H[e[n]]+=1;for(var o=0,n=58;n>0;--n){var h=o+H[n]>>1;H[n]=o,o=h}for(var n=0;n<65537;++n){var f=e[n];f>0&&(e[n]=f|H[f]++<<6)}}function K(e,n,o,h,f,v,C){for(var b=o,F=0,O=0;f<=v;f++){if(b.value-o.value>h)return!1;$(6,F,O,e,b);var k=q.l;if(F=q.c,O=q.lc,C[f]=k,k==63){if(b.value-o.value>h)throw"Something wrong with hufUnpackEncTable";$(8,F,O,e,b);var D=q.l+6;if(F=q.c,O=q.lc,f+D>v+1)throw"Something wrong with hufUnpackEncTable";for(;D--;)C[f++]=0;f--}else if(k>=59){var D=k-59+2;if(f+D>v+1)throw"Something wrong with hufUnpackEncTable";for(;D--;)C[f++]=0;f--}}ee(C)}function _e(e){return e&63}function we(e){return e>>6}function Me(e,n,o,h){for(;n<=o;n++){var f=we(e[n]),v=_e(e[n]);if(f>>v)throw"Invalid table entry";if(v>14){var C=h[f>>v-14];if(C.len)throw"Invalid table entry";if(C.lit++,C.p){var b=C.p;C.p=new Array(C.lit);for(var F=0;F<C.lit-1;++F)C.p[F]=b[F]}else C.p=new Array(1);C.p[C.lit-1]=n}else if(v)for(var O=0,F=1<<14-v;F>0;F--){var C=h[(f<<14-v)+O];if(C.len||C.p)throw"Invalid table entry";C.len=v,C.lit=n,O++}}return!0}const ne={c:0,lc:0};function ye(e,n,o,h){e=e<<8|st(o,h),n+=8,ne.c=e,ne.lc=n}const se={c:0,lc:0};function ve(e,n,o,h,f,v,C,b,F,O){if(e==n){h<8&&(ye(o,h,f,C),o=ne.c,h=ne.lc),h-=8;var k=o>>h,k=new Uint8Array([k])[0];if(F.value+k>O)return!1;for(var D=b[F.value-1];k-- >0;)b[F.value++]=D}else if(F.value<O)b[F.value++]=e;else return!1;se.c=o,se.lc=h}function Re(e){return e&65535}function qe(e){var n=Re(e);return n>32767?n-65536:n}const ie={a:0,b:0};function Fe(e,n){var o=qe(e),h=qe(n),f=h,v=o+(f&1)+(f>>1),C=v,b=v-f;ie.a=C,ie.b=b}function Le(e,n){var o=Re(e),h=Re(n),f=o-(h>>1)&65535,v=h+f-32768&65535;ie.a=v,ie.b=f}function qt(e,n,o,h,f,v,C){for(var b=C<16384,F=o>f?f:o,O=1,k;O<=F;)O<<=1;for(O>>=1,k=O,O>>=1;O>=1;){for(var D=0,fe=D+v*(f-k),j=v*O,Y=v*k,Q=h*O,J=h*k,le,ue,Ee,Ie;D<=fe;D+=Y){for(var he=D,Ze=D+h*(o-k);he<=Ze;he+=J){var de=he+Q,be=he+j,We=be+Q;b?(Fe(e[he+n],e[be+n]),le=ie.a,Ee=ie.b,Fe(e[de+n],e[We+n]),ue=ie.a,Ie=ie.b,Fe(le,ue),e[he+n]=ie.a,e[de+n]=ie.b,Fe(Ee,Ie),e[be+n]=ie.a,e[We+n]=ie.b):(Le(e[he+n],e[be+n]),le=ie.a,Ee=ie.b,Le(e[de+n],e[We+n]),ue=ie.a,Ie=ie.b,Le(le,ue),e[he+n]=ie.a,e[de+n]=ie.b,Le(Ee,Ie),e[be+n]=ie.a,e[We+n]=ie.b)}if(o&O){var be=he+j;b?Fe(e[he+n],e[be+n]):Le(e[he+n],e[be+n]),le=ie.a,e[be+n]=ie.b,e[he+n]=le}}if(f&O)for(var he=D,Ze=D+h*(o-k);he<=Ze;he+=J){var de=he+Q;b?Fe(e[he+n],e[de+n]):Le(e[he+n],e[de+n]),le=ie.a,e[de+n]=ie.b,e[he+n]=le}k=O,O>>=1}return D}function Qt(e,n,o,h,f,v,C,b,F,O){for(var k=0,D=0,fe=b,j=Math.trunc(f.value+(v+7)/8);f.value<j;)for(ye(k,D,o,f),k=ne.c,D=ne.lc;D>=14;){var Y=k>>D-14&16383,Q=n[Y];if(Q.len)D-=Q.len,ve(Q.lit,C,k,D,o,h,f,F,O,fe),k=se.c,D=se.lc;else{if(!Q.p)throw"hufDecode issues";var J;for(J=0;J<Q.lit;J++){for(var le=_e(e[Q.p[J]]);D<le&&f.value<j;)ye(k,D,o,f),k=ne.c,D=ne.lc;if(D>=le&&we(e[Q.p[J]])==(k>>D-le&(1<<le)-1)){D-=le,ve(Q.p[J],C,k,D,o,h,f,F,O,fe),k=se.c,D=se.lc;break}}if(J==Q.lit)throw"hufDecode issues"}}var ue=8-v&7;for(k>>=ue,D-=ue;D>0;){var Q=n[k<<14-D&16383];if(Q.len)D-=Q.len,ve(Q.lit,C,k,D,o,h,f,F,O,fe),k=se.c,D=se.lc;else throw"hufDecode issues"}return!0}function Dt(e,n,o,h,f,v){var C={value:0},b=o.value,F=Se(n,o),O=Se(n,o);o.value+=4;var k=Se(n,o);if(o.value+=4,F<0||F>=65537||O<0||O>=65537)throw"Something wrong with HUF_ENCSIZE";var D=new Array(65537),fe=new Array(16384);V(fe);var j=h-(o.value-b);if(K(e,n,o,j,F,O,D),k>8*(h-(o.value-b)))throw"Something wrong with hufUncompress";Me(D,F,O,fe),Qt(D,fe,e,n,o,k,O,v,f,C)}function Ut(e,n,o){for(var h=0;h<o;++h)n[h]=e[n[h]]}function vt(e){for(var n=1;n<e.length;n++){var o=e[n-1]+e[n]-128;e[n]=o}}function gt(e,n){for(var o=0,h=Math.floor((e.length+1)/2),f=0,v=e.length-1;!(f>v||(n[f++]=e[o++],f>v));)n[f++]=e[h++]}function Ot(e){for(var n=e.byteLength,o=new Array,h=0,f=new DataView(e);n>0;){var v=f.getInt8(h++);if(v<0){var C=-v;n-=C+1;for(var b=0;b<C;b++)o.push(f.getUint8(h++))}else{var C=v;n-=2;for(var F=f.getUint8(h++),b=0;b<C+1;b++)o.push(F)}}return o}function Jt(e,n,o,h,f,v){var de=new DataView(v.buffer),C=o[e.idx[0]].width,b=o[e.idx[0]].height,F=3,O=Math.floor(C/8),k=Math.ceil(C/8),D=Math.ceil(b/8),fe=C-(k-1)*8,j=b-(D-1)*8,Y={value:0},Q=new Array(F),J=new Array(F),le=new Array(F),ue=new Array(F),Ee=new Array(F);for(let ce=0;ce<F;++ce)Ee[ce]=n[e.idx[ce]],Q[ce]=ce<1?0:Q[ce-1]+k*D,J[ce]=new Float32Array(64),le[ce]=new Uint16Array(64),ue[ce]=new Uint16Array(k*64);for(let ce=0;ce<D;++ce){var Ie=8;ce==D-1&&(Ie=j);var he=8;for(let me=0;me<k;++me){me==k-1&&(he=fe);for(let oe=0;oe<F;++oe)le[oe].fill(0),le[oe][0]=f[Q[oe]++],Pt(Y,h,le[oe]),Ft(le[oe],J[oe]),Lt(J[oe]);er(J);for(let oe=0;oe<F;++oe)tr(J[oe],ue[oe],me*64)}let xe=0;for(let me=0;me<F;++me){const oe=o[e.idx[me]].type;for(let Ue=8*ce;Ue<8*ce+Ie;++Ue){xe=Ee[me][Ue];for(let nt=0;nt<O;++nt){const Ce=nt*64+(Ue&7)*8;de.setUint16(xe+0*oe,ue[me][Ce+0],!0),de.setUint16(xe+2*oe,ue[me][Ce+1],!0),de.setUint16(xe+4*oe,ue[me][Ce+2],!0),de.setUint16(xe+6*oe,ue[me][Ce+3],!0),de.setUint16(xe+8*oe,ue[me][Ce+4],!0),de.setUint16(xe+10*oe,ue[me][Ce+5],!0),de.setUint16(xe+12*oe,ue[me][Ce+6],!0),de.setUint16(xe+14*oe,ue[me][Ce+7],!0),xe+=16*oe}}if(O!=k)for(let Ue=8*ce;Ue<8*ce+Ie;++Ue){const nt=Ee[me][Ue]+8*O*2*oe,Ce=O*64+(Ue&7)*8;for(let Xe=0;Xe<he;++Xe)de.setUint16(nt+Xe*2*oe,ue[me][Ce+Xe],!0)}}}for(var Ze=new Uint16Array(C),de=new DataView(v.buffer),be=0;be<F;++be){o[e.idx[be]].decoded=!0;var We=o[e.idx[be]].type;if(o[be].type==2)for(var _t=0;_t<b;++_t){const ce=Ee[be][_t];for(var De=0;De<C;++De)Ze[De]=de.getUint16(ce+De*2*We,!0);for(var De=0;De<C;++De)de.setFloat32(ce+De*2*We,A(Ze[De]),!0)}}}function Pt(e,n,o){for(var h,f=1;f<64;)h=n[e.value],h==65280?f=64:h>>8==255?f+=h&255:(o[f]=h,f++),e.value++}function Ft(e,n){n[0]=A(e[0]),n[1]=A(e[1]),n[2]=A(e[5]),n[3]=A(e[6]),n[4]=A(e[14]),n[5]=A(e[15]),n[6]=A(e[27]),n[7]=A(e[28]),n[8]=A(e[2]),n[9]=A(e[4]),n[10]=A(e[7]),n[11]=A(e[13]),n[12]=A(e[16]),n[13]=A(e[26]),n[14]=A(e[29]),n[15]=A(e[42]),n[16]=A(e[3]),n[17]=A(e[8]),n[18]=A(e[12]),n[19]=A(e[17]),n[20]=A(e[25]),n[21]=A(e[30]),n[22]=A(e[41]),n[23]=A(e[43]),n[24]=A(e[9]),n[25]=A(e[11]),n[26]=A(e[18]),n[27]=A(e[24]),n[28]=A(e[31]),n[29]=A(e[40]),n[30]=A(e[44]),n[31]=A(e[53]),n[32]=A(e[10]),n[33]=A(e[19]),n[34]=A(e[23]),n[35]=A(e[32]),n[36]=A(e[39]),n[37]=A(e[45]),n[38]=A(e[52]),n[39]=A(e[54]),n[40]=A(e[20]),n[41]=A(e[22]),n[42]=A(e[33]),n[43]=A(e[38]),n[44]=A(e[46]),n[45]=A(e[51]),n[46]=A(e[55]),n[47]=A(e[60]),n[48]=A(e[21]),n[49]=A(e[34]),n[50]=A(e[37]),n[51]=A(e[47]),n[52]=A(e[50]),n[53]=A(e[56]),n[54]=A(e[59]),n[55]=A(e[61]),n[56]=A(e[35]),n[57]=A(e[36]),n[58]=A(e[48]),n[59]=A(e[49]),n[60]=A(e[57]),n[61]=A(e[58]),n[62]=A(e[62]),n[63]=A(e[63])}function Lt(e){const n=.5*Math.cos(.7853975),o=.5*Math.cos(3.14159/16),h=.5*Math.cos(3.14159/8),f=.5*Math.cos(3*3.14159/16),v=.5*Math.cos(5*3.14159/16),C=.5*Math.cos(3*3.14159/8),b=.5*Math.cos(7*3.14159/16);for(var F=new Array(4),O=new Array(4),k=new Array(4),D=new Array(4),fe=0;fe<8;++fe){var j=fe*8;F[0]=h*e[j+2],F[1]=C*e[j+2],F[2]=h*e[j+6],F[3]=C*e[j+6],O[0]=o*e[j+1]+f*e[j+3]+v*e[j+5]+b*e[j+7],O[1]=f*e[j+1]-b*e[j+3]-o*e[j+5]-v*e[j+7],O[2]=v*e[j+1]-o*e[j+3]+b*e[j+5]+f*e[j+7],O[3]=b*e[j+1]-v*e[j+3]+f*e[j+5]-o*e[j+7],k[0]=n*(e[j+0]+e[j+4]),k[3]=n*(e[j+0]-e[j+4]),k[1]=F[0]+F[3],k[2]=F[1]-F[2],D[0]=k[0]+k[1],D[1]=k[3]+k[2],D[2]=k[3]-k[2],D[3]=k[0]-k[1],e[j+0]=D[0]+O[0],e[j+1]=D[1]+O[1],e[j+2]=D[2]+O[2],e[j+3]=D[3]+O[3],e[j+4]=D[3]-O[3],e[j+5]=D[2]-O[2],e[j+6]=D[1]-O[1],e[j+7]=D[0]-O[0]}for(var Y=0;Y<8;++Y)F[0]=h*e[16+Y],F[1]=C*e[16+Y],F[2]=h*e[48+Y],F[3]=C*e[48+Y],O[0]=o*e[8+Y]+f*e[24+Y]+v*e[40+Y]+b*e[56+Y],O[1]=f*e[8+Y]-b*e[24+Y]-o*e[40+Y]-v*e[56+Y],O[2]=v*e[8+Y]-o*e[24+Y]+b*e[40+Y]+f*e[56+Y],O[3]=b*e[8+Y]-v*e[24+Y]+f*e[40+Y]-o*e[56+Y],k[0]=n*(e[Y]+e[32+Y]),k[3]=n*(e[Y]-e[32+Y]),k[1]=F[0]+F[3],k[2]=F[1]-F[2],D[0]=k[0]+k[1],D[1]=k[3]+k[2],D[2]=k[3]-k[2],D[3]=k[0]-k[1],e[0+Y]=D[0]+O[0],e[8+Y]=D[1]+O[1],e[16+Y]=D[2]+O[2],e[24+Y]=D[3]+O[3],e[32+Y]=D[3]-O[3],e[40+Y]=D[2]-O[2],e[48+Y]=D[1]-O[1],e[56+Y]=D[0]-O[0]}function er(e){for(var n=0;n<64;++n){var o=e[0][n],h=e[1][n],f=e[2][n];e[0][n]=o+1.5747*f,e[1][n]=o-.1873*h-.4682*f,e[2][n]=o+1.8556*h}}function tr(e,n,o){for(var h=0;h<64;++h)n[o+h]=dt.toHalfFloat(Nt(e[h]))}function Nt(e){return e<=1?Math.sign(e)*Math.pow(Math.abs(e),2.2):Math.sign(e)*Math.pow(M,Math.abs(e)-1)}function at(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function Qe(e){var n=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),o=new Uint8Array(Ot(n)),h=new Uint8Array(o.length);return vt(o),gt(o,h),new DataView(h.buffer)}function wt(e){var n=e.array.slice(e.offset.value,e.offset.value+e.size),o=Zt(n),h=new Uint8Array(o.length);return vt(o),gt(o,h),new DataView(h.buffer)}function rr(e){for(var n=e.viewer,o={value:e.offset.value},h=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),f=new Uint8Array(8192),v=0,C=new Array(e.channels),b=0;b<e.channels;b++)C[b]={},C[b].start=v,C[b].end=C[b].start,C[b].nx=e.width,C[b].ny=e.lines,C[b].size=e.type,v+=C[b].nx*C[b].ny*C[b].size;var F=Te(n,o),O=Te(n,o);if(O>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(F<=O)for(var b=0;b<O-F+1;b++)f[b+F]=s(n,o);var k=new Uint16Array(65536),D=P(f,k),fe=Se(n,o);Dt(e.array,n,o,fe,h,v);for(var b=0;b<e.channels;++b)for(var j=C[b],Y=0;Y<C[b].size;++Y)qt(h,j.start+Y,j.nx,j.size,j.ny,j.nx*j.size,D);Ut(k,h,v);for(var Q=0,J=new Uint8Array(h.buffer.byteLength),le=0;le<e.lines;le++)for(var ue=0;ue<e.channels;ue++){var j=C[ue],Ee=j.nx*j.size,Ie=new Uint8Array(h.buffer,j.end*2,Ee*2);J.set(Ie,Q),Q+=Ee*2,j.end+=Ee}return new DataView(J.buffer)}function kt(e){var n=e.array.slice(e.offset.value,e.offset.value+e.size),o=Zt(n);const h=e.lines*e.channels*e.width,f=e.type==1?new Uint16Array(h):new Uint32Array(h);let v=0,C=0;const b=new Array(4);for(let F=0;F<e.lines;F++)for(let O=0;O<e.channels;O++){let k=0;switch(e.type){case 1:b[0]=v,b[1]=b[0]+e.width,v=b[1]+e.width;for(let D=0;D<e.width;++D){const fe=o[b[0]++]<<8|o[b[1]++];k+=fe,f[C]=k,C++}break;case 2:b[0]=v,b[1]=b[0]+e.width,b[2]=b[1]+e.width,v=b[2]+e.width;for(let D=0;D<e.width;++D){const fe=o[b[0]++]<<24|o[b[1]++]<<16|o[b[2]++]<<8;k+=fe,f[C]=k,C++}break}}return new DataView(f.buffer)}function it(e){var n=e.viewer,o={value:e.offset.value},h=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),f={version:x(n,o),unknownUncompressedSize:x(n,o),unknownCompressedSize:x(n,o),acCompressedSize:x(n,o),dcCompressedSize:x(n,o),rleCompressedSize:x(n,o),rleUncompressedSize:x(n,o),rleRawSize:x(n,o),totalAcUncompressedCount:x(n,o),totalDcUncompressedCount:x(n,o),acCompression:x(n,o)};if(f.version<2)throw"EXRLoader.parse: "+Et.compression+" version "+f.version+" is unsupported";for(var v=new Array,C=Te(n,o)-2;C>0;){var b=ot(n.buffer,o),F=s(n,o),O=F>>2&3,k=(F>>4)-1,D=new Int8Array([k])[0],fe=s(n,o);v.push({name:b,index:D,type:fe,compression:O}),C-=b.length+3}for(var j=Et.channels,Y=new Array(e.channels),Q=0;Q<e.channels;++Q){var J=Y[Q]={},le=j[Q];J.name=le.name,J.compression=0,J.decoded=!1,J.type=le.pixelType,J.pLinear=le.pLinear,J.width=e.width,J.height=e.lines}for(var ue={idx:new Array(3)},Ee=0;Ee<e.channels;++Ee)for(var J=Y[Ee],Q=0;Q<v.length;++Q){var Ie=v[Q];J.name==Ie.name&&(J.compression=Ie.compression,Ie.index>=0&&(ue.idx[Ie.index]=Ee),J.offset=Ee)}if(f.acCompressedSize>0)switch(f.acCompression){case 0:var de=new Uint16Array(f.totalAcUncompressedCount);Dt(e.array,n,o,f.acCompressedSize,de,f.totalAcUncompressedCount);break;case 1:var he=e.array.slice(o.value,o.value+f.totalAcUncompressedCount),Ze=Zt(he),de=new Uint16Array(Ze.buffer);o.value+=f.totalAcUncompressedCount;break}if(f.dcCompressedSize>0){var be={array:e.array,offset:o,size:f.dcCompressedSize},We=new Uint16Array(wt(be).buffer);o.value+=f.dcCompressedSize}if(f.rleRawSize>0){var he=e.array.slice(o.value,o.value+f.rleCompressedSize),Ze=Zt(he),_t=Ot(Ze.buffer);o.value+=f.rleCompressedSize}for(var De=0,ce=new Array(Y.length),Q=0;Q<ce.length;++Q)ce[Q]=new Array;for(var xe=0;xe<e.lines;++xe)for(var me=0;me<Y.length;++me)ce[me].push(De),De+=Y[me].width*e.type*2;Jt(ue,ce,Y,de,We,h);for(var Q=0;Q<Y.length;++Q){var J=Y[Q];if(!J.decoded)switch(J.compression){case 2:for(var oe=0,Ue=0,xe=0;xe<e.lines;++xe){for(var nt=ce[Q][oe],Ce=0;Ce<J.width;++Ce){for(var Xe=0;Xe<2*J.type;++Xe)h[nt++]=_t[Ue+Xe*J.width*J.height];Ue++}oe++}break;case 1:default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(h.buffer)}function ot(e,n){for(var o=new Uint8Array(e),h=0;o[n.value+h]!=0;)h+=1;var f=new TextDecoder().decode(o.slice(n.value,n.value+h));return n.value=n.value+h+1,f}function nr(e,n,o){var h=new TextDecoder().decode(new Uint8Array(e).slice(n.value,n.value+o));return n.value=n.value+o,h}function Bt(e,n){var o=Je(e,n),h=Se(e,n);return[o,h]}function ar(e,n){var o=Se(e,n),h=Se(e,n);return[o,h]}function Je(e,n){var o=e.getInt32(n.value,!0);return n.value=n.value+4,o}function Se(e,n){var o=e.getUint32(n.value,!0);return n.value=n.value+4,o}function st(e,n){var o=e[n.value];return n.value=n.value+1,o}function s(e,n){var o=e.getUint8(n.value);return n.value=n.value+1,o}const x=function(e,n){let o;return"getBigInt64"in DataView.prototype?o=Number(e.getBigInt64(n.value,!0)):o=e.getUint32(n.value+4,!0)+Number(e.getUint32(n.value,!0)<<32),n.value+=8,o};function Z(e,n){var o=e.getFloat32(n.value,!0);return n.value+=4,o}function ae(e,n){return dt.toHalfFloat(Z(e,n))}function A(e){var n=(e&31744)>>10,o=e&1023;return(e>>15?-1:1)*(n?n===31?o?NaN:1/0:Math.pow(2,n-15)*(1+o/1024):6103515625e-14*(o/1024))}function Te(e,n){var o=e.getUint16(n.value,!0);return n.value+=2,o}function He(e,n){return A(Te(e,n))}function br(e,n,o,h){for(var f=o.value,v=[];o.value<f+h-1;){var C=ot(n,o),b=Je(e,o),F=s(e,o);o.value+=3;var O=Je(e,o),k=Je(e,o);v.push({name:C,pixelType:b,pLinear:F,xSampling:O,ySampling:k})}return o.value+=1,v}function zt(e,n){var o=Z(e,n),h=Z(e,n),f=Z(e,n),v=Z(e,n),C=Z(e,n),b=Z(e,n),F=Z(e,n),O=Z(e,n);return{redX:o,redY:h,greenX:f,greenY:v,blueX:C,blueY:b,whiteX:F,whiteY:O}}function Ne(e,n){var o=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],h=s(e,n);return o[h]}function ke(e,n){var o=Se(e,n),h=Se(e,n),f=Se(e,n),v=Se(e,n);return{xMin:o,yMin:h,xMax:f,yMax:v}}function et(e,n){var o=["INCREASING_Y"],h=s(e,n);return o[h]}function tt(e,n){var o=Z(e,n),h=Z(e,n);return[o,h]}function rt(e,n){var o=Z(e,n),h=Z(e,n),f=Z(e,n);return[o,h,f]}function lt(e,n,o,h,f){if(h==="string"||h==="stringvector"||h==="iccProfile")return nr(n,o,f);if(h==="chlist")return br(e,n,o,f);if(h==="chromaticities")return zt(e,o);if(h==="compression")return Ne(e,o);if(h==="box2i")return ke(e,o);if(h==="lineOrder")return et(e,o);if(h==="float")return Z(e,o);if(h==="v2f")return tt(e,o);if(h==="v3f")return rt(e,o);if(h==="int")return Je(e,o);if(h==="rational")return Bt(e,o);if(h==="timecode")return ar(e,o);if(h==="preview")return o.value+=f,"skipped";o.value+=f}function Jr(e,n,o){const h={};if(e.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";h.version=e.getUint8(4);const f=e.getUint8(5);h.spec={singleTile:!!(f&2),longName:!!(f&4),deepFormat:!!(f&8),multiPart:!!(f&16)},o.value=8;for(var v=!0;v;){var C=ot(n,o);if(C==0)v=!1;else{var b=ot(n,o),F=Se(e,o),O=lt(e,n,o,b,F);O===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${b}'.`):h[C]=O}}if((f&-5)!=0)throw console.error("EXRHeader:",h),"THREE.EXRLoader: provided file is currently unsupported.";return h}function en(e,n,o,h,f){const v={size:0,viewer:n,array:o,offset:h,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[Mt?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":v.lines=1,v.uncompress=at;break;case"RLE_COMPRESSION":v.lines=1,v.uncompress=Qe;break;case"ZIPS_COMPRESSION":v.lines=1,v.uncompress=wt;break;case"ZIP_COMPRESSION":v.lines=16,v.uncompress=wt;break;case"PIZ_COMPRESSION":v.lines=32,v.uncompress=rr;break;case"PXR24_COMPRESSION":v.lines=16,v.uncompress=kt;break;case"DWAA_COMPRESSION":v.lines=32,v.uncompress=it;break;case"DWAB_COMPRESSION":v.lines=256,v.uncompress=it;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(v.scanlineBlockSize=v.lines,v.type==1)switch(f){case Ye:v.getter=He,v.inputSize=2;break;case Ae:v.getter=Te,v.inputSize=2;break}else if(v.type==2)switch(f){case Ye:v.getter=Z,v.inputSize=4;break;case Ae:v.getter=ae,v.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+v.type+" for "+e.compression+".";v.blockCount=(e.dataWindow.yMax+1)/v.scanlineBlockSize;for(var C=0;C<v.blockCount;C++)x(n,h);v.outputChannels=v.channels==3?4:v.channels;const b=v.width*v.height*v.outputChannels;switch(f){case Ye:v.byteArray=new Float32Array(b),v.channels<v.outputChannels&&v.byteArray.fill(1,0,b);break;case Ae:v.byteArray=new Uint16Array(b),v.channels<v.outputChannels&&v.byteArray.fill(15360,0,b);break;default:console.error("THREE.EXRLoader: unsupported type: ",f);break}return v.bytesPerLine=v.width*v.inputSize*v.channels,v.outputChannels==4?v.format=It:v.format=ln,Mt?v.colorSpace="srgb-linear":v.encoding=3e3,v}const Ht=new DataView(r),tn=new Uint8Array(r),yt={value:0},Et=Jr(Ht,r,yt),te=en(Et,Ht,tn,yt,this.type),Sr={value:0},rn={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<te.height/te.scanlineBlockSize;e++){const n=Se(Ht,yt);te.size=Se(Ht,yt),te.lines=n+te.scanlineBlockSize>te.height?te.height-n:te.scanlineBlockSize;const h=te.size<te.lines*te.bytesPerLine?te.uncompress(te):at(te);yt.value+=te.size;for(let f=0;f<te.scanlineBlockSize;f++){const v=f+e*te.scanlineBlockSize;if(v>=te.height)break;for(let C=0;C<te.channels;C++){const b=rn[Et.channels[C].name];for(let F=0;F<te.width;F++){Sr.value=(f*(te.channels*te.width)+C*te.width+F)*te.inputSize;const O=(te.height-1-v)*(te.width*te.outputChannels)+F*te.outputChannels+b;te.byteArray[O]=te.getter(h,Sr)}}}}return{header:Et,width:te.width,height:te.height,data:te.byteArray,format:te.format,[Mt?"colorSpace":"encoding"]:te[Mt?"colorSpace":"encoding"],type:this.type}}setDataType(r){return this.type=r,this}load(r,i,t,l){function c(d,m){Mt?d.colorSpace=m.colorSpace:d.encoding=m.encoding,d.minFilter=Ge,d.magFilter=Ge,d.generateMipmaps=!1,d.flipY=!1,i&&i(d,m)}return super.load(r,c,t,l)}}const ka=y.forwardRef(({makeDefault:a,camera:r,regress:i,domElement:t,enableDamping:l=!0,keyEvents:c=!1,onChange:d,onStart:m,onEnd:p,...u},T)=>{const R=ge(g=>g.invalidate),E=ge(g=>g.camera),G=ge(g=>g.gl),B=ge(g=>g.events),S=ge(g=>g.setEvents),U=ge(g=>g.set),L=ge(g=>g.get),I=ge(g=>g.performance),W=r||E,z=t||B.connected||G.domElement,_=y.useMemo(()=>new Kn(W),[W]);return Ct(()=>{_.enabled&&_.update()},-1),y.useEffect(()=>(c&&_.connect(c===!0?z:c),_.connect(z),()=>void _.dispose()),[c,z,i,_,R]),y.useEffect(()=>{const g=M=>{R(),i&&I.regress(),d&&d(M)},N=M=>{m&&m(M)},w=M=>{p&&p(M)};return _.addEventListener("change",g),_.addEventListener("start",N),_.addEventListener("end",w),()=>{_.removeEventListener("start",N),_.removeEventListener("end",w),_.removeEventListener("change",g)}},[d,m,p,_,R,S]),y.useEffect(()=>{if(a){const g=L().controls;return U({controls:_}),()=>U({controls:g})}},[a,_]),y.createElement("primitive",je({ref:T,object:_,enableDamping:l},u))}),ta=y.forwardRef(function({children:r,disable:i,disableX:t,disableY:l,disableZ:c,left:d,right:m,top:p,bottom:u,front:T,back:R,onCentered:E,precise:G=!0,cacheKey:B=0,...S},U){const L=y.useRef(null),I=y.useRef(null),W=y.useRef(null);return y.useLayoutEffect(()=>{I.current.matrixWorld.identity();const z=new Or().setFromObject(W.current,G),_=new re,g=new cn,N=z.max.x-z.min.x,w=z.max.y-z.min.y,M=z.max.z-z.min.z;z.getCenter(_),z.getBoundingSphere(g);const P=p?w/2:u?-w/2:0,V=d?-N/2:m?N/2:0,q=T?M/2:R?-M/2:0;I.current.position.set(i||t?0:-_.x+V,i||l?0:-_.y+P,i||c?0:-_.z+q),typeof E<"u"&&E({parent:L.current.parent,container:L.current,width:N,height:w,depth:M,boundingBox:z,boundingSphere:g,center:_,verticalAlignment:P,horizontalAlignment:V,depthAlignment:q})},[B,E,p,d,T,i,t,l,c,G,m,u,R]),y.useImperativeHandle(U,()=>L.current,[]),y.createElement("group",je({ref:L},S),y.createElement("group",{ref:I},y.createElement("group",{ref:W},r)))}),ra=Nr({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");var Oe=function(a){return a[a.NONE=0]="NONE",a[a.START=1]="START",a[a.ACTIVE=2]="ACTIVE",a}(Oe||{});const ht=a=>a&&a.isOrthographicCamera,na=a=>a&&a.isBox3,aa=a=>1-Math.exp(-5*a)+.007*a,jr=y.createContext(null);function ia({children:a,maxDuration:r=1,margin:i=1.2,observe:t,fit:l,clip:c,interpolateFunc:d=aa,onFit:m}){const p=y.useRef(null),{camera:u,size:T,invalidate:R}=ge(),E=ge(_=>_.controls),G=y.useRef(m);G.current=m;const B=y.useRef({camPos:new re,camRot:new St,camZoom:1}),S=y.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),U=y.useRef(Oe.NONE),L=y.useRef(0),[I]=y.useState(()=>new Or),W=y.useMemo(()=>{function _(){const g=I.getSize(new re),N=I.getCenter(new re),w=Math.max(g.x,g.y,g.z),M=ht(u)?w*4:w/(2*Math.atan(Math.PI*u.fov/360)),P=ht(u)?w*4:M/u.aspect,V=i*Math.max(M,P);return{box:I,size:g,center:N,distance:V}}return{getSize:_,refresh(g){if(na(g))I.copy(g);else{const N=g||p.current;if(!N)return this;N.updateWorldMatrix(!0,!0),I.setFromObject(N)}if(I.isEmpty()){const N=u.position.length()||10;I.setFromCenterAndSize(new re,new re(N,N,N))}return B.current.camPos.copy(u.position),B.current.camRot.copy(u.quaternion),ht(u)&&(B.current.camZoom=u.zoom),S.current.camPos=void 0,S.current.camRot=void 0,S.current.camZoom=void 0,S.current.camUp=void 0,S.current.target=void 0,this},reset(){const{center:g,distance:N}=_(),w=u.position.clone().sub(g).normalize();S.current.camPos=g.clone().addScaledVector(w,N),S.current.target=g.clone();const M=new or().lookAt(S.current.camPos,S.current.target,u.up);return S.current.camRot=new St().setFromRotationMatrix(M),U.current=Oe.START,L.current=0,this},moveTo(g){return S.current.camPos=Array.isArray(g)?new re(...g):g.clone(),U.current=Oe.START,L.current=0,this},lookAt({target:g,up:N}){S.current.target=Array.isArray(g)?new re(...g):g.clone(),N?S.current.camUp=Array.isArray(N)?new re(...N):N.clone():S.current.camUp=u.up.clone();const w=new or().lookAt(S.current.camPos||u.position,S.current.target,S.current.camUp);return S.current.camRot=new St().setFromRotationMatrix(w),U.current=Oe.START,L.current=0,this},to({position:g,target:N}){return this.moveTo(g).lookAt({target:N})},fit(){if(!ht(u))return this.reset();let g=0,N=0;const w=[new re(I.min.x,I.min.y,I.min.z),new re(I.min.x,I.max.y,I.min.z),new re(I.min.x,I.min.y,I.max.z),new re(I.min.x,I.max.y,I.max.z),new re(I.max.x,I.max.y,I.max.z),new re(I.max.x,I.max.y,I.min.z),new re(I.max.x,I.min.y,I.max.z),new re(I.max.x,I.min.y,I.min.z)],M=S.current.camPos||u.position,P=S.current.target||(E==null?void 0:E.target),V=S.current.camUp||u.up,q=P?new or().lookAt(M,P,V).setPosition(M).invert():u.matrixWorldInverse;for(const ee of w)ee.applyMatrix4(q),g=Math.max(g,Math.abs(ee.y)),N=Math.max(N,Math.abs(ee.x));g*=2,N*=2;const $=(u.top-u.bottom)/g,H=(u.right-u.left)/N;return S.current.camZoom=Math.min($,H)/i,U.current=Oe.START,L.current=0,G.current&&G.current(this.getSize()),this},clip(){const{distance:g}=_();return u.near=g/100,u.far=g*100,u.updateProjectionMatrix(),E&&(E.maxDistance=g*10,E.update()),R(),this}}},[I,u,E,i,R]);y.useLayoutEffect(()=>{if(E){const _=()=>{if(E&&S.current.target&&U.current!==Oe.NONE){const g=new re().setFromMatrixColumn(u.matrix,2),N=B.current.camPos.distanceTo(E.target),w=(S.current.camPos||B.current.camPos).distanceTo(S.current.target),M=(1-L.current)*N+L.current*w;E.target.copy(u.position).addScaledVector(g,-M),E.update()}U.current=Oe.NONE};return E.addEventListener("start",_),()=>E.removeEventListener("start",_)}},[E]);const z=y.useRef(0);return y.useLayoutEffect(()=>{(t||z.current++===0)&&(W.refresh(),l&&W.reset().fit(),c&&W.clip())},[T,c,l,t,u,E]),Ct((_,g)=>{if(U.current===Oe.START)U.current=Oe.ACTIVE,R();else if(U.current===Oe.ACTIVE){if(L.current+=g/r,L.current>=1)S.current.camPos&&u.position.copy(S.current.camPos),S.current.camRot&&u.quaternion.copy(S.current.camRot),S.current.camUp&&u.up.copy(S.current.camUp),S.current.camZoom&&ht(u)&&(u.zoom=S.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix(),E&&S.current.target&&(E.target.copy(S.current.target),E.update()),U.current=Oe.NONE;else{const N=d(L.current);S.current.camPos&&u.position.lerpVectors(B.current.camPos,S.current.camPos,N),S.current.camRot&&u.quaternion.slerpQuaternions(B.current.camRot,S.current.camRot,N),S.current.camUp&&u.up.set(0,1,0).applyQuaternion(u.quaternion),S.current.camZoom&&ht(u)&&(u.zoom=(1-N)*B.current.camZoom+N*S.current.camZoom),u.updateMatrixWorld(),u.updateProjectionMatrix()}R()}}),y.createElement("group",{ref:p},y.createElement(jr.Provider,{value:W},a))}function oa(){return y.useContext(jr)}const Yr=(a,r,i)=>{let t;switch(a){case hr:t=new Uint8ClampedArray(r*i*4);break;case Ae:t=new Uint16Array(r*i*4);break;case vn:t=new Uint32Array(r*i*4);break;case fn:t=new Int8Array(r*i*4);break;case mn:t=new Int16Array(r*i*4);break;case pn:t=new Int32Array(r*i*4);break;case Ye:t=new Float32Array(r*i*4);break;default:throw new Error("Unsupported data type")}return t};let Wt;const sa=(a,r,i,t)=>{if(Wt!==void 0)return Wt;const l=new ft(1,1,t);r.setRenderTarget(l);const c=new Vt(new mr,new dn({color:16777215}));r.render(c,i),r.setRenderTarget(null);const d=Yr(a,l.width,l.height);return r.readRenderTargetPixels(l,0,0,l.width,l.height,d),l.dispose(),c.geometry.dispose(),c.material.dispose(),Wt=d[0]!==0,Wt};class vr{constructor(r){var i,t,l,c,d,m,p,u,T,R,E,G,B,S,U,L;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(W){throw this._renderer.setRenderTarget(null),W}this._renderer.setRenderTarget(null)},this._width=r.width,this._height=r.height,this._type=r.type,this._colorSpace=r.colorSpace;const I={format:It,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:((i=r.renderTargetOptions)===null||i===void 0?void 0:i.anisotropy)!==void 0?(t=r.renderTargetOptions)===null||t===void 0?void 0:t.anisotropy:1,generateMipmaps:((l=r.renderTargetOptions)===null||l===void 0?void 0:l.generateMipmaps)!==void 0?(c=r.renderTargetOptions)===null||c===void 0?void 0:c.generateMipmaps:!1,magFilter:((d=r.renderTargetOptions)===null||d===void 0?void 0:d.magFilter)!==void 0?(m=r.renderTargetOptions)===null||m===void 0?void 0:m.magFilter:Ge,minFilter:((p=r.renderTargetOptions)===null||p===void 0?void 0:p.minFilter)!==void 0?(u=r.renderTargetOptions)===null||u===void 0?void 0:u.minFilter:Ge,samples:((T=r.renderTargetOptions)===null||T===void 0?void 0:T.samples)!==void 0?(R=r.renderTargetOptions)===null||R===void 0?void 0:R.samples:void 0,wrapS:((E=r.renderTargetOptions)===null||E===void 0?void 0:E.wrapS)!==void 0?(G=r.renderTargetOptions)===null||G===void 0?void 0:G.wrapS:Ve,wrapT:((B=r.renderTargetOptions)===null||B===void 0?void 0:B.wrapT)!==void 0?(S=r.renderTargetOptions)===null||S===void 0?void 0:S.wrapT:Ve};if(this._material=r.material,r.renderer?this._renderer=r.renderer:(this._renderer=vr.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new Pr,this._camera=new jt,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!sa(this._type,this._renderer,this._camera,I)){let W;switch(this._type){case Ae:W=this._renderer.extensions.has("EXT_color_buffer_float")?Ye:void 0;break}W!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${Ye}`),this._type=W):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new Vt(new mr,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new ft(this.width,this.height,I),this._renderTarget.texture.mapping=((U=r.renderTargetOptions)===null||U===void 0?void 0:U.mapping)!==void 0?(L=r.renderTargetOptions)===null||L===void 0?void 0:L.mapping:Xt}static instantiateRenderer(){const r=new un;return r.setSize(128,128),r}toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const r=Yr(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,r),r}toDataTexture(r){const i=new hn(this.toArray(),this.width,this.height,It,this._type,(r==null?void 0:r.mapping)||Xt,(r==null?void 0:r.wrapS)||Ve,(r==null?void 0:r.wrapT)||Ve,(r==null?void 0:r.magFilter)||Ge,(r==null?void 0:r.minFilter)||Ge,(r==null?void 0:r.anisotropy)||1,ur);return i.generateMipmaps=(r==null?void 0:r.generateMipmaps)!==void 0?r==null?void 0:r.generateMipmaps:!1,i}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(r){this.disposeOnDemandRenderer(),r&&this.renderTarget.dispose(),this.material instanceof Tt&&Object.values(this.material.uniforms).forEach(i=>{i.value instanceof pt&&i.value.dispose()}),Object.values(this.material).forEach(i=>{i instanceof pt&&i.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(r){this._width=r,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(r){this._height=r,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(r){this._renderTarget=r,this._width=r.width,this._height=r.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}const la=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,ca=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class ua extends Tt{constructor({gamma:r,offsetHdr:i,offsetSdr:t,gainMapMin:l,gainMapMax:c,maxDisplayBoost:d,hdrCapacityMin:m,hdrCapacityMax:p,sdr:u,gainMap:T}){super({name:"GainMapDecoderMaterial",vertexShader:la,fragmentShader:ca,uniforms:{sdr:{value:u},gainMap:{value:T},gamma:{value:new re(1/r[0],1/r[1],1/r[2])},offsetHdr:{value:new re().fromArray(i)},offsetSdr:{value:new re().fromArray(t)},gainMapMin:{value:new re().fromArray(l)},gainMapMax:{value:new re().fromArray(c)},weightFactor:{value:(Math.log2(d)-m)/(p-m)}},blending:En,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=d,this._hdrCapacityMin=m,this._hdrCapacityMax=p,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(r){this.uniforms.sdr.value=r}get gainMap(){return this.uniforms.gainMap.value}set gainMap(r){this.uniforms.gainMap.value=r}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(r){this.uniforms.offsetHdr.value.fromArray(r)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(r){this.uniforms.offsetSdr.value.fromArray(r)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(r){this.uniforms.gainMapMin.value.fromArray(r)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(r){this.uniforms.gainMapMax.value.fromArray(r)}get gamma(){const r=this.uniforms.gamma.value;return[1/r.x,1/r.y,1/r.z]}set gamma(r){const i=this.uniforms.gamma.value;i.x=1/r[0],i.y=1/r[1],i.z=1/r[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(r){this._hdrCapacityMin=r,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(r){this._hdrCapacityMax=r,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(r){this._maxDisplayBoost=Math.max(1,Math.min(65504,r)),this.calculateWeight()}calculateWeight(){const r=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,r))}}class Xr extends Error{}class $r extends Error{}const bt=(a,r,i)=>{const t=new RegExp(`${r}="([^"]*)"`,"i").exec(a);if(t)return t[1];const l=new RegExp(`<${r}[^>]*>([\\s\\S]*?)</${r}>`,"i").exec(a);if(l){const c=l[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return c&&c.length===3?c.map(d=>d.replace(/<\/?rdf:li>/g,"")):l[1].trim()}if(i!==void 0)return i;throw new Error(`Can't find ${r} in gainmap metadata`)},ha=a=>{let r;typeof TextDecoder<"u"?r=new TextDecoder().decode(a):r=a.toString();let i=r.indexOf("<x:xmpmeta");for(;i!==-1;){const t=r.indexOf("x:xmpmeta>",i),l=r.slice(i,t+10);try{const c=bt(l,"hdrgm:GainMapMin","0"),d=bt(l,"hdrgm:GainMapMax"),m=bt(l,"hdrgm:Gamma","1"),p=bt(l,"hdrgm:OffsetSDR","0.015625"),u=bt(l,"hdrgm:OffsetHDR","0.015625"),T=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(l),R=T?T[1]:"0",E=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(l);if(!E)throw new Error("Incomplete gainmap metadata");const G=E[1];return{gainMapMin:Array.isArray(c)?c.map(B=>parseFloat(B)):[parseFloat(c),parseFloat(c),parseFloat(c)],gainMapMax:Array.isArray(d)?d.map(B=>parseFloat(B)):[parseFloat(d),parseFloat(d),parseFloat(d)],gamma:Array.isArray(m)?m.map(B=>parseFloat(B)):[parseFloat(m),parseFloat(m),parseFloat(m)],offsetSdr:Array.isArray(p)?p.map(B=>parseFloat(B)):[parseFloat(p),parseFloat(p),parseFloat(p)],offsetHdr:Array.isArray(u)?u.map(B=>parseFloat(B)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(R),hdrCapacityMax:parseFloat(G)}}catch{}i=r.indexOf("<x:xmpmeta",t)}};class da{constructor(r){this.options={debug:r&&r.debug!==void 0?r.debug:!1,extractFII:r&&r.extractFII!==void 0?r.extractFII:!0,extractNonFII:r&&r.extractNonFII!==void 0?r.extractNonFII:!0}}extract(r){return new Promise((i,t)=>{const l=this.options.debug,c=new DataView(r.buffer);if(c.getUint16(0)!==65496){t(new Error("Not a valid jpeg"));return}const d=c.byteLength;let m=2,p=0,u;for(;m<d;){if(++p>250){t(new Error(`Found no marker after ${p} loops `));return}if(c.getUint8(m)!==255){t(new Error(`Not a valid marker at offset 0x${m.toString(16)}, found: 0x${c.getUint8(m).toString(16)}`));return}if(u=c.getUint8(m+1),l&&console.log(`Marker: ${u.toString(16)}`),u===226){l&&console.log("Found APP2 marker (0xffe2)");const T=m+4;if(c.getUint32(T)===1297106432){const R=T+4;let E;if(c.getUint16(R)===18761)E=!1;else if(c.getUint16(R)===19789)E=!0;else{t(new Error("No valid endianness marker found in TIFF header"));return}if(c.getUint16(R+2,!E)!==42){t(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const G=c.getUint32(R+4,!E);if(G<8){t(new Error("Not valid TIFF data! (First offset less than 8)"));return}const B=R+G,S=c.getUint16(B,!E),U=B+2;let L=0;for(let _=U;_<U+12*S;_+=12)c.getUint16(_,!E)===45057&&(L=c.getUint32(_+8,!E));const W=B+2+S*12+4,z=[];for(let _=W;_<W+L*16;_+=16){const g={MPType:c.getUint32(_,!E),size:c.getUint32(_+4,!E),dataOffset:c.getUint32(_+8,!E),dependantImages:c.getUint32(_+12,!E),start:-1,end:-1,isFII:!1};g.dataOffset?(g.start=R+g.dataOffset,g.isFII=!1):(g.start=0,g.isFII=!0),g.end=g.start+g.size,z.push(g)}if(this.options.extractNonFII&&z.length){const _=new Blob([c]),g=[];for(const N of z){if(N.isFII&&!this.options.extractFII)continue;const w=_.slice(N.start,N.end+1,"image/jpeg");g.push(w)}i(g)}}}m+=2+c.getUint16(m+2)}})}}const pa=async a=>{const r=ha(a);if(!r)throw new $r("Gain map XMP metadata not found");const t=await new da({extractFII:!0,extractNonFII:!0}).extract(a);if(t.length!==2)throw new Xr("Gain map recovery image not found");return{sdr:new Uint8Array(await t[0].arrayBuffer()),gainMap:new Uint8Array(await t[1].arrayBuffer()),metadata:r}},Dr=a=>new Promise((r,i)=>{const t=document.createElement("img");t.onload=()=>{r(t)},t.onerror=l=>{i(l)},t.src=URL.createObjectURL(a)});class Vr extends gn{constructor(r,i){super(i),r&&(this._renderer=r),this._internalLoadingManager=new wn}setRenderer(r){return this._renderer=r,this}setRenderTargetOptions(r){return this._renderTargetOptions=r,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const r=new ua({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new pt,sdr:new pt});return new vr({width:16,height:16,type:Ae,colorSpace:ur,material:r,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(r,i,t,l){const c=l?new Blob([l],{type:"image/jpeg"}):void 0,d=new Blob([t],{type:"image/jpeg"});let m,p,u=!1;if(typeof createImageBitmap>"u"){const E=await Promise.all([c?Dr(c):Promise.resolve(void 0),Dr(d)]);p=E[0],m=E[1],u=!0}else{const E=await Promise.all([c?createImageBitmap(c,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(d,{imageOrientation:"flipY"})]);p=E[0],m=E[1]}const T=new pt(p||new ImageData(2,2),Xt,Ve,Ve,Ge,Tr,It,hr,1,ur);T.flipY=u,T.needsUpdate=!0;const R=new pt(m,Xt,Ve,Ve,Ge,Tr,It,hr,1,yn);R.flipY=u,R.needsUpdate=!0,r.width=m.width,r.height=m.height,r.material.gainMap=T,r.material.sdr=R,r.material.gainMapMin=i.gainMapMin,r.material.gainMapMax=i.gainMapMax,r.material.offsetHdr=i.offsetHdr,r.material.offsetSdr=i.offsetSdr,r.material.gamma=i.gamma,r.material.hdrCapacityMin=i.hdrCapacityMin,r.material.hdrCapacityMax=i.hdrCapacityMax,r.material.maxDisplayBoost=Math.pow(2,i.hdrCapacityMax),r.material.needsUpdate=!0,r.render()}}class ma extends Vr{load([r,i,t],l,c,d){const m=this.prepareQuadRenderer();let p,u,T;const R=async()=>{if(p&&u&&T){try{await this.render(m,T,p,u)}catch(M){this.manager.itemError(r),this.manager.itemError(i),this.manager.itemError(t),typeof d=="function"&&d(M),m.disposeOnDemandRenderer();return}typeof l=="function"&&l(m),this.manager.itemEnd(r),this.manager.itemEnd(i),this.manager.itemEnd(t),m.disposeOnDemandRenderer()}};let E=!0,G=0,B=0,S=!0,U=0,L=0,I=!0,W=0,z=0;const _=()=>{if(typeof c=="function"){const M=G+U+W,P=B+L+z,V=E&&S&&I;c(new ProgressEvent("progress",{lengthComputable:V,loaded:P,total:M}))}};this.manager.itemStart(r),this.manager.itemStart(i),this.manager.itemStart(t);const g=new Yt(this._internalLoadingManager);g.setResponseType("arraybuffer"),g.setRequestHeader(this.requestHeader),g.setPath(this.path),g.setWithCredentials(this.withCredentials),g.load(r,async M=>{if(typeof M=="string")throw new Error("Invalid sdr buffer");p=M,await R()},M=>{E=M.lengthComputable,B=M.loaded,G=M.total,_()},M=>{this.manager.itemError(r),typeof d=="function"&&d(M)});const N=new Yt(this._internalLoadingManager);N.setResponseType("arraybuffer"),N.setRequestHeader(this.requestHeader),N.setPath(this.path),N.setWithCredentials(this.withCredentials),N.load(i,async M=>{if(typeof M=="string")throw new Error("Invalid gainmap buffer");u=M,await R()},M=>{S=M.lengthComputable,L=M.loaded,U=M.total,_()},M=>{this.manager.itemError(i),typeof d=="function"&&d(M)});const w=new Yt(this._internalLoadingManager);return w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(t,async M=>{if(typeof M!="string")throw new Error("Invalid metadata string");T=JSON.parse(M),await R()},M=>{I=M.lengthComputable,z=M.loaded,W=M.total,_()},M=>{this.manager.itemError(t),typeof d=="function"&&d(M)}),m}}class fa extends Vr{load(r,i,t,l){const c=this.prepareQuadRenderer(),d=new Yt(this._internalLoadingManager);return d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setPath(this.path),d.setWithCredentials(this.withCredentials),this.manager.itemStart(r),d.load(r,async m=>{if(typeof m=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const p=new Uint8Array(m);let u,T,R;try{const E=await pa(p);u=E.sdr,T=E.gainMap,R=E.metadata}catch(E){if(E instanceof $r||E instanceof Xr)console.warn(`Failure to reconstruct an HDR image from ${r}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),R={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=p;else throw E}try{await this.render(c,R,u,T)}catch(E){this.manager.itemError(r),typeof l=="function"&&l(E),c.disposeOnDemandRenderer();return}typeof i=="function"&&i(c),this.manager.itemEnd(r),c.disposeOnDemandRenderer()},t,m=>{this.manager.itemError(r),typeof l=="function"&&l(m)}),c}}const Rt={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},Kr="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",mt=a=>Array.isArray(a),gr=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Kt({files:a=gr,path:r="",preset:i=void 0,colorSpace:t=void 0,extensions:l}={}){i&&(wr(i),a=Rt[i],r=Kr);const c=mt(a),{extension:d,isCubemap:m}=yr(a),p=Er(d);if(!p)throw new Error("useEnvironment: Unrecognized file extension: "+a);const u=ge(G=>G.gl);y.useLayoutEffect(()=>{if(d!=="webp"&&d!=="jpg"&&d!=="jpeg")return;function G(){$t.clear(p,c?[a]:a)}u.domElement.addEventListener("webglcontextlost",G,{once:!0})},[a,u.domElement]);const T=$t(p,c?[a]:a,G=>{(d==="webp"||d==="jpg"||d==="jpeg")&&G.setRenderer(u),G.setPath==null||G.setPath(r),l&&l(G)});let R=c?T[0]:T;if(d==="jpg"||d==="jpeg"||d==="webp"){var E;R=(E=R.renderTarget)==null?void 0:E.texture}return R.mapping=m?_n:Mn,R.colorSpace=t??(m?"srgb":"srgb-linear"),R}const va={files:gr,path:"",preset:void 0,extensions:void 0};Kt.preload=a=>{const r={...va,...a};let{files:i,path:t=""}=r;const{preset:l,extensions:c}=r;l&&(wr(l),i=Rt[l],t=Kr);const{extension:d}=yr(i);if(d==="webp"||d==="jpg"||d==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const m=Er(d);if(!m)throw new Error("useEnvironment: Unrecognized file extension: "+i);$t.preload(m,mt(i)?[i]:i,p=>{p.setPath==null||p.setPath(t),c&&c(p)})};const ga={files:gr,preset:void 0};Kt.clear=a=>{const r={...ga,...a};let{files:i}=r;const{preset:t}=r;t&&(wr(t),i=Rt[t]);const{extension:l}=yr(i),c=Er(l);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+i);$t.clear(c,mt(i)?[i]:i)};function wr(a){if(!(a in Rt))throw new Error("Preset must be one of: "+Object.keys(Rt).join(", "))}function yr(a){var r;const i=mt(a)&&a.length===6,t=mt(a)&&a.length===3&&a.some(d=>d.endsWith("json")),l=mt(a)?a[0]:a;return{extension:i?"cube":t?"webp":l.startsWith("data:application/exr")?"exr":l.startsWith("data:application/hdr")?"hdr":l.startsWith("data:image/jpeg")?"jpg":(r=l.split(".").pop())==null||(r=r.split("?"))==null||(r=r.shift())==null?void 0:r.toLowerCase(),isCubemap:i,isGainmap:t}}function Er(a){return a==="cube"?bn:a==="hdr"?Jn:a==="exr"?ea:a==="jpg"||a==="jpeg"?fa:a==="webp"?ma:null}const wa=a=>a.current&&a.current.isScene,ya=a=>wa(a)?a.current:a;function _r(a,r,i,t,l={}){var c,d,m,p;l={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...l};const u=ya(r||i),T=u.background,R=u.environment,E={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(c=(d=u.backgroundRotation)==null||d.clone==null?void 0:d.clone())!==null&&c!==void 0?c:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(m=(p=u.environmentRotation)==null||p.clone==null?void 0:p.clone())!==null&&m!==void 0?m:[0,0,0]};return a!=="only"&&(u.environment=t),a&&(u.background=t),Ir(u,l),()=>{a!=="only"&&(u.environment=R),a&&(u.background=T),Ir(u,E)}}function Mr({scene:a,background:r=!1,map:i,...t}){const l=ge(c=>c.scene);return y.useLayoutEffect(()=>{if(i)return _r(r,a,l,i,t)}),null}function qr({background:a=!1,scene:r,blur:i,backgroundBlurriness:t,backgroundIntensity:l,backgroundRotation:c,environmentIntensity:d,environmentRotation:m,...p}){const u=Kt(p),T=ge(R=>R.scene);return y.useLayoutEffect(()=>_r(a,r,T,u,{backgroundBlurriness:i??t,backgroundIntensity:l,backgroundRotation:c,environmentIntensity:d,environmentRotation:m})),y.useEffect(()=>()=>{u.dispose()},[u]),null}function Ea({children:a,near:r=.1,far:i=1e3,resolution:t=256,frames:l=1,map:c,background:d=!1,blur:m,backgroundBlurriness:p,backgroundIntensity:u,backgroundRotation:T,environmentIntensity:R,environmentRotation:E,scene:G,files:B,path:S,preset:U=void 0,extensions:L}){const I=ge(w=>w.gl),W=ge(w=>w.scene),z=y.useRef(null),[_]=y.useState(()=>new Pr),g=y.useMemo(()=>{const w=new Sn(t);return w.texture.type=Ae,w},[t]);y.useEffect(()=>()=>{g.dispose()},[g]),y.useLayoutEffect(()=>{if(l===1){const w=I.autoClear;I.autoClear=!0,z.current.update(I,_),I.autoClear=w}return _r(d,G,W,g.texture,{backgroundBlurriness:m??p,backgroundIntensity:u,backgroundRotation:T,environmentIntensity:R,environmentRotation:E})},[a,_,g.texture,G,W,d,l,I]);let N=1;return Ct(()=>{if(l===1/0||N<l){const w=I.autoClear;I.autoClear=!0,z.current.update(I,_),I.autoClear=w,N++}}),y.createElement(y.Fragment,null,xn(y.createElement(y.Fragment,null,a,y.createElement("cubeCamera",{ref:z,args:[r,i,g]}),B||U?y.createElement(qr,{background:!0,files:B,preset:U,path:S,extensions:L}):c?y.createElement(Mr,{background:!0,map:c,extensions:L}):null),_))}function _a(a){var r,i,t,l;const c=Kt(a),d=a.map||c;y.useMemo(()=>Fr({GroundProjectedEnvImpl:Zn}),[]),y.useEffect(()=>()=>{c.dispose()},[c]);const m=y.useMemo(()=>[d],[d]),p=(r=a.ground)==null?void 0:r.height,u=(i=a.ground)==null?void 0:i.radius,T=(t=(l=a.ground)==null?void 0:l.scale)!==null&&t!==void 0?t:1e3;return y.createElement(y.Fragment,null,y.createElement(Mr,je({},a,{map:d})),y.createElement("groundProjectedEnvImpl",{args:m,scale:T,height:p,radius:u}))}function Ma(a){return a.ground?y.createElement(_a,a):a.map?y.createElement(Mr,a):a.children?y.createElement(Ea,a):y.createElement(qr,a)}const ba=y.forwardRef(({scale:a=10,frames:r=1/0,opacity:i=1,width:t=1,height:l=1,blur:c=1,near:d=0,far:m=10,resolution:p=512,smooth:u=!0,color:T="#000000",depthWrite:R=!1,renderOrder:E,...G},B)=>{const S=y.useRef(null),U=ge(H=>H.scene),L=ge(H=>H.gl),I=y.useRef(null);t=t*(Array.isArray(a)?a[0]:a||1),l=l*(Array.isArray(a)?a[1]:a||1);const[W,z,_,g,N,w,M]=y.useMemo(()=>{const H=new ft(p,p),ee=new ft(p,p);ee.texture.generateMipmaps=H.texture.generateMipmaps=!1;const K=new mr(t,l).rotateX(Math.PI/2),_e=new Vt(K),we=new Tn;we.depthTest=we.depthWrite=!1,we.onBeforeCompile=ye=>{ye.uniforms={...ye.uniforms,ucolor:{value:new fr(T)}},ye.fragmentShader=ye.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),ye.fragmentShader=ye.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};const Me=new Tt(qn),ne=new Tt(Qn);return ne.depthTest=Me.depthTest=!1,[H,K,we,_e,Me,ne,ee]},[p,t,l,a,T]),P=H=>{g.visible=!0,g.material=N,N.uniforms.tDiffuse.value=W.texture,N.uniforms.h.value=H*1/256,L.setRenderTarget(M),L.render(g,I.current),g.material=w,w.uniforms.tDiffuse.value=M.texture,w.uniforms.v.value=H*1/256,L.setRenderTarget(W),L.render(g,I.current),g.visible=!1};let V=0,q,$;return Ct(()=>{I.current&&(r===1/0||V<r)&&(V++,q=U.background,$=U.overrideMaterial,S.current.visible=!1,U.background=null,U.overrideMaterial=_,L.setRenderTarget(W),L.render(U,I.current),P(c),u&&P(c*.4),L.setRenderTarget(null),S.current.visible=!0,U.overrideMaterial=$,U.background=q)}),y.useImperativeHandle(B,()=>S.current,[]),y.createElement("group",je({"rotation-x":Math.PI/2},G,{ref:S}),y.createElement("mesh",{renderOrder:E,geometry:z,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},y.createElement("meshBasicMaterial",{transparent:!0,map:W.texture,opacity:i,depthWrite:R})),y.createElement("orthographicCamera",{ref:I,args:[-t/2,t/2,l/2,-l/2,d,m]}))});function Sa(a){return a.isLight}function xa(a){return!!a.geometry}const Qr=y.createContext(null),Ta=Nr({color:new fr,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${kr>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),Ia=y.forwardRef(({children:a,temporal:r,frames:i=40,limit:t=1/0,blend:l=20,scale:c=10,opacity:d=1,alphaTest:m=.75,color:p="black",colorBlend:u=2,resolution:T=1024,toneMapped:R=!0,...E},G)=>{Fr({SoftShadowMaterial:Ta});const B=ge(g=>g.gl),S=ge(g=>g.scene),U=ge(g=>g.camera),L=ge(g=>g.invalidate),I=y.useRef(null),W=y.useRef(null),[z]=y.useState(()=>new Ca(B,S,T));y.useLayoutEffect(()=>{z.configure(I.current)},[]);const _=y.useMemo(()=>({lights:new Map,temporal:!!r,frames:Math.max(2,i),blend:Math.max(2,i===1/0?l:i),count:0,getMesh:()=>I.current,reset:()=>{z.clear();const g=I.current.material;g.opacity=0,g.alphaTest=0,_.count=0},update:(g=1)=>{const N=I.current.material;_.temporal?(N.opacity=Math.min(d,N.opacity+d/_.blend),N.alphaTest=Math.min(m,N.alphaTest+m/_.blend)):(N.opacity=d,N.alphaTest=m),W.current.visible=!0,z.prepare();for(let w=0;w<g;w++)_.lights.forEach(M=>M.update()),z.update(U,_.blend);W.current.visible=!1,z.finish()}}),[z,U,S,r,i,l,d,m]);return y.useLayoutEffect(()=>{_.reset(),!_.temporal&&_.frames!==1/0&&_.update(_.blend)}),y.useImperativeHandle(G,()=>_,[_]),Ct(()=>{(_.temporal||_.frames===1/0)&&_.count<_.frames&&_.count<t&&(L(),_.update(),_.count++)}),y.createElement("group",E,y.createElement("group",{traverse:()=>null,ref:W},y.createElement(Qr.Provider,{value:_},a)),y.createElement("mesh",{receiveShadow:!0,ref:I,scale:c,rotation:[-Math.PI/2,0,0]},y.createElement("planeGeometry",null),y.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:R,color:p,blend:u,map:z.progressiveLightMap2.texture})))}),Ra=y.forwardRef(({castShadow:a=!0,bias:r=.001,mapSize:i=512,size:t=5,near:l=.5,far:c=500,frames:d=1,position:m=[0,0,0],radius:p=1,amount:u=8,intensity:T=kr>=155?Math.PI:1,ambient:R=.5,...E},G)=>{const B=y.useRef(null),S=new re(...m).length(),U=y.useContext(Qr),L=y.useCallback(()=>{let W;if(B.current)for(let z=0;z<B.current.children.length;z++)if(W=B.current.children[z],Math.random()>R)W.position.set(m[0]+sr.randFloatSpread(p),m[1]+sr.randFloatSpread(p),m[2]+sr.randFloatSpread(p));else{let _=Math.acos(2*Math.random()-1)-Math.PI/2,g=2*Math.PI*Math.random();W.position.set(Math.cos(_)*Math.cos(g)*S,Math.abs(Math.cos(_)*Math.sin(g)*S),Math.sin(_)*S)}},[p,R,S,...m]),I=y.useMemo(()=>({update:L}),[L]);return y.useImperativeHandle(G,()=>I,[I]),y.useLayoutEffect(()=>{var W;const z=B.current;return U&&((W=U.lights)==null||W.set(z.uuid,I)),()=>{var _;return void(U==null||(_=U.lights)==null?void 0:_.delete(z.uuid))}},[U,I]),y.createElement("group",je({ref:B},E),Array.from({length:u},(W,z)=>y.createElement("directionalLight",{key:z,castShadow:a,"shadow-bias":r,"shadow-mapSize":[i,i],intensity:T/u},y.createElement("orthographicCamera",{attach:"shadow-camera",args:[-t,t,t,-t,l,c]}))))});class Ca{constructor(r,i,t=1024){this.renderer=r,this.res=t,this.scene=i,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new fr,this.clearAlpha=0;const l={type:Ae,magFilter:Rr,minFilter:Rr};this.progressiveLightMap1=new ft(this.res,this.res,l),this.progressiveLightMap2=new ft(this.res,this.res,l),this.discardMat=new ra,this.targetMat=new In({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=c=>{c.vertexShader=`varying vec2 vUv;
`+c.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const d=c.fragmentShader.indexOf("void main() {");c.fragmentShader=`varying vec2 vUv;
`+c.fragmentShader.slice(0,d)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+c.fragmentShader.slice(d-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,c.uniforms.previousShadowMap=this.previousShadowMap,c.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(r=>{xa(r)?this.meshes.push({object:r,material:r.material}):Sa(r)&&this.lights.push({object:r,intensity:r.intensity})})}prepare(){this.lights.forEach(r=>r.object.intensity=0),this.meshes.forEach(r=>r.object.material=this.discardMat)}finish(){this.lights.forEach(r=>r.object.intensity=r.intensity),this.meshes.forEach(r=>r.object.material=r.material)}configure(r){this.object=r}update(r,i=100){if(!this.object)return;this.averagingWindow.value=i,this.object.material=this.targetMat;const t=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,l=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,c=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(t),this.previousShadowMap.value=l.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,r),this.renderer.setRenderTarget(null),this.scene.background=c}}const Aa={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function Da({radius:a,adjustCamera:r}){const i=oa();return y.useEffect(()=>{r&&i.refresh().clip().fit()},[a,r]),null}function Ba({children:a,center:r,adjustCamera:i=!0,intensity:t=.5,shadows:l="contact",environment:c="city",preset:d="rembrandt",...m}){var p,u,T,R,E,G,B,S;const U=typeof d=="string"?Aa[d]:d,[{radius:L,height:I},W]=y.useState({radius:0,width:0,height:0,depth:0}),z=(p=l==null?void 0:l.bias)!==null&&p!==void 0?p:-1e-4,_=(u=l==null?void 0:l.normalBias)!==null&&u!==void 0?u:0,g=(T=l==null?void 0:l.size)!==null&&T!==void 0?T:1024,N=(R=l==null?void 0:l.offset)!==null&&R!==void 0?R:0,w=l==="contact"||(l==null?void 0:l.type)==="contact",M=l==="accumulative"||(l==null?void 0:l.type)==="accumulative",P={...typeof l=="object"?l:{}},V=c?typeof c=="string"?{preset:c}:c:null,q=y.useCallback($=>{const{width:H,height:ee,depth:K,boundingSphere:_e}=$;W({radius:_e.radius,width:H,height:ee,depth:K}),r!=null&&r.onCentered&&r.onCentered($)},[]);return y.createElement(y.Fragment,null,y.createElement("ambientLight",{intensity:t/3}),y.createElement("spotLight",{penumbra:1,position:[U.main[0]*L,U.main[1]*L,U.main[2]*L],intensity:t*2,castShadow:!!l,"shadow-bias":z,"shadow-normalBias":_,"shadow-mapSize":g}),y.createElement("pointLight",{position:[U.fill[0]*L,U.fill[1]*L,U.fill[2]*L],intensity:t}),y.createElement(ia,je({fit:!!i,clip:!!i,margin:Number(i),observe:!0},m),y.createElement(Da,{radius:L,adjustCamera:i}),y.createElement(ta,je({},r,{position:[0,N/2,0],onCentered:q}),a)),y.createElement("group",{position:[0,-I/2-N/2,0]},w&&y.createElement(ba,je({scale:L*4,far:L,blur:2},P)),M&&y.createElement(Ia,je({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:L*4},P),y.createElement(Ra,{amount:(E=P.amount)!==null&&E!==void 0?E:8,radius:(G=P.radius)!==null&&G!==void 0?G:L,ambient:(B=P.ambient)!==null&&B!==void 0?B:.5,intensity:(S=P.intensity)!==null&&S!==void 0?S:1,position:[U.main[0]*L,U.main[1]*L,U.main[2]*L],size:L*4,bias:-z,mapSize:g}))),c&&y.createElement(Ma,V))}export{ka as O,Ba as S};
