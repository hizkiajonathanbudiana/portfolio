import{am as J,e as K,an as Q,ao as U,ap as V,aq as Z,ar as $,as as ee,at as ne,au as re,av as te,aw as oe}from"./events-e3cb66e2.esm-DFm8s4y8.js";import{r as o,j as u}from"./index-B-HRXyag.js";function W(n,r){let t;return(...i)=>{window.clearTimeout(t),t=window.setTimeout(()=>n(...i),r)}}function se({debounce:n,scroll:r,polyfill:t,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const f=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!f)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[a,b]=o.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),e=o.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:a,orientationHandler:null}),d=n?typeof n=="number"?n:n.scroll:null,m=n?typeof n=="number"?n:n.resize:null,w=o.useRef(!1);o.useEffect(()=>(w.current=!0,()=>void(w.current=!1)));const[C,y,l]=o.useMemo(()=>{const s=()=>{if(!e.current.element)return;const{left:L,top:O,width:H,height:z,bottom:B,right:k,x:M,y:g}=e.current.element.getBoundingClientRect(),c={left:L,top:O,width:H,height:z,bottom:B,right:k,x:M,y:g};e.current.element instanceof HTMLElement&&i&&(c.height=e.current.element.offsetHeight,c.width=e.current.element.offsetWidth),Object.freeze(c),w.current&&!le(e.current.lastBounds,c)&&b(e.current.lastBounds=c)};return[s,m?W(s,m):s,d?W(s,d):s]},[b,i,d,m]);function p(){e.current.scrollContainers&&(e.current.scrollContainers.forEach(s=>s.removeEventListener("scroll",l,!0)),e.current.scrollContainers=null),e.current.resizeObserver&&(e.current.resizeObserver.disconnect(),e.current.resizeObserver=null),e.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",e.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",e.current.orientationHandler))}function x(){e.current.element&&(e.current.resizeObserver=new f(l),e.current.resizeObserver.observe(e.current.element),r&&e.current.scrollContainers&&e.current.scrollContainers.forEach(s=>s.addEventListener("scroll",l,{capture:!0,passive:!0})),e.current.orientationHandler=()=>{l()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",e.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",e.current.orientationHandler))}const j=s=>{!s||s===e.current.element||(p(),e.current.element=s,e.current.scrollContainers=_(s),x())};return ce(l,!!r),ie(y),o.useEffect(()=>{p(),x()},[r,l,y]),o.useEffect(()=>p,[]),[j,a,C]}function ie(n){o.useEffect(()=>{const r=n;return window.addEventListener("resize",r),()=>void window.removeEventListener("resize",r)},[n])}function ce(n,r){o.useEffect(()=>{if(r){const t=n;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[n,r])}function _(n){const r=[];if(!n||n===document.body)return r;const{overflow:t,overflowX:i,overflowY:f}=window.getComputedStyle(n);return[t,i,f].some(a=>a==="auto"||a==="scroll")&&r.push(n),[...r,..._(n.parentElement)]}const ue=["x","y","top","bottom","left","right","width","height"],le=(n,r)=>ue.every(t=>n[t]===r[t]);function ae({ref:n,children:r,fallback:t,resize:i,style:f,gl:a,events:b=$,eventSource:e,eventPrefix:d,shadows:m,linear:w,flat:C,legacy:y,orthographic:l,frameloop:p,dpr:x,performance:j,raycaster:s,camera:L,scene:O,onPointerMissed:H,onCreated:z,...B}){o.useMemo(()=>K(oe),[]);const k=Q(),[M,g]=se({scroll:!0,debounce:{scroll:50,resize:0},...i}),c=o.useRef(null),S=o.useRef(null);o.useImperativeHandle(n,()=>c.current);const T=U(H),[I,q]=o.useState(!1),[X,A]=o.useState(!1);if(I)throw I;if(X)throw X;const R=o.useRef(null);V(()=>{const E=c.current;if(g.width>0&&g.height>0&&E){R.current||(R.current=Z(E));async function F(){await R.current.configure({gl:a,scene:O,events:b,shadows:m,linear:w,flat:C,legacy:y,orthographic:l,frameloop:p,dpr:x,performance:j,raycaster:s,camera:L,size:g,onPointerMissed:(...h)=>T.current==null?void 0:T.current(...h),onCreated:h=>{h.events.connect==null||h.events.connect(e?ee(e)?e.current:e:S.current),d&&h.setEvents({compute:(P,v)=>{const N=P[d+"X"],G=P[d+"Y"];v.pointer.set(N/v.size.width*2-1,-(G/v.size.height)*2+1),v.raycaster.setFromCamera(v.pointer,v.camera)}}),z==null||z(h)}}),R.current.render(u.jsx(k,{children:u.jsx(ne,{set:A,children:u.jsx(o.Suspense,{fallback:u.jsx(re,{set:q}),children:r??null})})}))}F()}}),o.useEffect(()=>{const E=c.current;if(E)return()=>te(E)},[]);const D=e?"none":"auto";return u.jsx("div",{ref:S,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:D,...f},...B,children:u.jsx("div",{ref:M,style:{width:"100%",height:"100%"},children:u.jsx("canvas",{ref:c,style:{display:"block"},children:t})})})}function he(n){return u.jsx(J,{children:u.jsx(ae,{...n})})}function Y(){return Y=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var i in t)({}).hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Y.apply(null,arguments)}export{he as C,Y as _};
